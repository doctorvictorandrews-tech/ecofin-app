<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>An√°lise Gratuita | Ecofin</title>
    <meta name="description" content="Preencha seus dados e descubra quanto voc√™ pode economizar no seu financiamento imobili√°rio.">
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Manrope:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ========================================================================
           DESIGN SYSTEM - MATCHING LANDING PAGE
           ======================================================================== */
        :root {
            --bg-body: #050505;
            --bg-surface: #0F0F0F;
            --bg-surface-light: #161616;
            
            --gold-primary: #D9890D;
            --gold-hover: #F59E0B;
            --gold-glow: rgba(217, 137, 13, 0.6);
            
            --text-primary: #FFFFFF;
            --text-secondary: #C4C4C4;
            
            --border-light: rgba(255, 255, 255, 0.1);
            --success: #10B981;
            --danger: #EF4444;

            --font-sans: 'Manrope', sans-serif;
            --font-body: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-body);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Background */
        .bg-blob {
            position: fixed; filter: blur(120px); z-index: -1; opacity: 0.15;
            animation: blobMove 20s infinite alternate ease-in-out; border-radius: 50%;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: var(--gold-primary); }
        .blob-2 { bottom: -20%; right: -20%; width: 60vw; height: 60vw; background: #5a3a00; animation-delay: -10s; }
        @keyframes blobMove { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }

        /* Container */
        .container { width: 90%; max-width: 900px; margin: 0 auto; padding: 40px 0; position: relative; z-index: 2; }

        /* Header */
        .header { text-align: center; margin-bottom: 50px; }
        .header img { height: 40px; margin: 0 auto 30px; }
        .header h1 { font-size: clamp(32px, 5vw, 48px); font-weight: 800; color: white; margin-bottom: 15px; letter-spacing: -1px; }
        .header p { font-size: 18px; color: var(--text-secondary); max-width: 600px; margin: 0 auto; }

        /* Progress Bar */
        .progress-wrapper { margin-bottom: 50px; }
        .progress-steps { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; position: relative; }
        .progress-line { position: absolute; top: 20px; left: 0; width: 100%; height: 3px; background: var(--border-light); z-index: 0; }
        .progress-line-fill { height: 100%; background: var(--gold-primary); transition: width 0.5s ease; box-shadow: 0 0 10px var(--gold-glow); }
        .step { position: relative; z-index: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .step-circle { width: 40px; height: 40px; border-radius: 50%; background: var(--bg-surface); border: 3px solid var(--border-light); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; transition: all 0.3s; }
        .step.active .step-circle { background: var(--gold-primary); border-color: var(--gold-primary); color: #000; box-shadow: 0 0 20px var(--gold-glow); }
        .step.completed .step-circle { background: var(--success); border-color: var(--success); color: white; }
        .step-label { font-size: 12px; color: var(--text-secondary); font-weight: 600; text-align: center; }
        .step.active .step-label { color: var(--gold-primary); }

        /* Card */
        .card { background: var(--bg-surface); border: 1px solid var(--border-light); border-radius: 20px; padding: 50px; box-shadow: 0 0 50px rgba(0,0,0,0.5); animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        .card-title { font-size: 28px; font-weight: 800; color: white; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; }
        .card-subtitle { font-size: 16px; color: var(--text-secondary); margin-bottom: 40px; }

        /* Form */
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 25px; margin-bottom: 40px; }
        @media(min-width: 768px) { .form-grid { grid-template-columns: repeat(2, 1fr); } }
        .form-group { display: flex; flex-direction: column; }
        .form-label { font-size: 13px; font-weight: 700; color: var(--text-secondary); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .form-input { background: #1A1A1A; border: 1px solid var(--border-light); color: white; padding: 16px; border-radius: 10px; font-family: var(--font-body); font-size: 16px; outline: none; transition: 0.3s; }
        .form-input:focus { border-color: var(--gold-primary); box-shadow: 0 0 0 4px rgba(217,137,13,0.1); }
        .form-input::placeholder { color: #666; }

        /* Select */
        .form-select { background: #1A1A1A url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%23D9890D' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") no-repeat right 16px center; appearance: none; }

        /* Option Cards */
        .option-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 40px; }
        @media(min-width: 768px) { .option-grid { grid-template-columns: repeat(2, 1fr); } }
        .option-card { background: #1A1A1A; border: 2px solid var(--border-light); border-radius: 16px; padding: 30px; cursor: pointer; transition: all 0.3s; text-align: center; position: relative; overflow: hidden; }
        .option-card:hover { border-color: var(--gold-primary); transform: translateY(-5px); }
        .option-card.selected { background: rgba(217, 137, 13, 0.1); border-color: var(--gold-primary); box-shadow: 0 0 30px rgba(217, 137, 13, 0.2); }
        .option-card.selected::before { content: '‚úì'; position: absolute; top: 15px; right: 15px; width: 28px; height: 28px; background: var(--gold-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #000; font-weight: bold; font-size: 18px; }
        .option-icon { font-size: 48px; margin-bottom: 20px; }
        .option-title { font-size: 20px; font-weight: 700; color: white; margin-bottom: 10px; }
        .option-desc { font-size: 14px; color: var(--text-secondary); }

        /* Upload Zone */
        .upload-zone { border: 2px dashed var(--border-light); border-radius: 16px; padding: 50px 30px; text-align: center; cursor: pointer; transition: 0.3s; background: #1A1A1A; position: relative; }
        .upload-zone:hover { border-color: var(--gold-primary); background: rgba(217, 137, 13, 0.05); }
        .upload-zone.dragover { border-color: var(--gold-primary); background: rgba(217, 137, 13, 0.1); transform: scale(1.02); }
        .upload-icon { font-size: 64px; color: var(--gold-primary); margin-bottom: 20px; }
        .upload-text { font-size: 18px; font-weight: 600; color: white; margin-bottom: 10px; }
        .upload-hint { font-size: 14px; color: var(--text-secondary); }
        .upload-preview { margin-top: 30px; }
        .upload-preview img { max-width: 100%; border-radius: 12px; border: 1px solid var(--border-light); }

        /* Loading */
        .loading-overlay { position: fixed; inset: 0; background: rgba(5, 5, 5, 0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
        .loading-spinner { width: 60px; height: 60px; border: 4px solid var(--border-light); border-top-color: var(--gold-primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 18px; font-weight: 600; color: white; margin-bottom: 10px; }
        .loading-subtext { font-size: 14px; color: var(--text-secondary); }

        /* Buttons */
        .btn-group { display: flex; gap: 15px; justify-content: space-between; padding-top: 40px; border-top: 1px solid var(--border-light); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 18px 36px; font-weight: 800; font-family: var(--font-sans); text-transform: uppercase; letter-spacing: 0.5px; border-radius: 10px; border: none; cursor: pointer; transition: all 0.3s ease; font-size: 14px; }
        .btn-primary { background: var(--gold-primary); color: #000; box-shadow: 0 0 20px rgba(217, 137, 13, 0.3); }
        .btn-primary:hover:not(:disabled) { background: var(--gold-hover); box-shadow: 0 0 50px rgba(217, 137, 13, 0.6); transform: translateY(-2px); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: transparent; border: 1px solid var(--border-light); color: white; }
        .btn-secondary:hover { border-color: var(--gold-primary); color: var(--gold-primary); }

        /* Success Screen */
        .success-screen { text-align: center; padding: 60px 20px; }
        .success-icon { font-size: 120px; margin-bottom: 30px; animation: scaleIn 0.5s ease-out; }
        @keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }
        .success-title { font-size: 36px; font-weight: 800; color: var(--gold-primary); margin-bottom: 20px; }
        .success-text { font-size: 18px; color: var(--text-secondary); max-width: 500px; margin: 0 auto 40px; line-height: 1.8; }

        /* Badge */
        .badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(217, 137, 13, 0.1); border: 1px solid rgba(217, 137, 13, 0.3); border-radius: 100px; font-size: 12px; font-weight: 700; color: var(--gold-primary); margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }

        /* Info Box */
        .info-box { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px; }
        .info-box p { margin: 0; font-size: 14px; color: var(--success); display: flex; align-items: center; gap: 10px; }

        /* Mobile */
        @media(max-width: 768px) {
            .container { padding: 20px 0; }
            .card { padding: 30px 20px; }
            .btn-group { flex-direction: column-reverse; }
            .btn { width: 100%; }
            .progress-steps { display: none; }
        }

        /* Skeleton */
        .skeleton { background: linear-gradient(90deg, #1A1A1A 25%, #2A2A2A 50%, #1A1A1A 75%); background-size: 200% 100%; animation: skeleton 1.5s ease-in-out infinite; border-radius: 8px; height: 20px; }
        @keyframes skeleton { to { background-position: -200% 0; } }
    </style>
</head>
<body>
    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============================================
        // CONFIGURA√á√ÉO DA API
        // ============================================
        const API_URL = 'https://ecofin-app-production.up.railway.app';
        
        // ATUALIZAR ESTA URL COM A DO SEU RAILWAY!
        // const API_URL = 'https://SEU-RAILWAY.up.railway.app';

        // ============================================
        // COMPONENTE PRINCIPAL
        // ============================================
        function FormularioCliente() {
            const [step, setStep] = useState(1);
            const [loading, setLoading] = useState(false);
            const [loadingText, setLoadingText] = useState('');
            const [submitted, setSubmitted] = useState(false);

            const [formData, setFormData] = useState({
                // Step 1: Dados Pessoais
                nome: '',
                whatsapp: '',
                email: '',
                objetivo: '',
                
                // Step 2: M√©todo
                metodo: '', // 'ocr' ou 'manual'
                
                // Step 2.5: Banco (se OCR)
                banco: '',
                
                // Step 3: Upload (se OCR)
                imagemContrato: null,
                imagemPreview: null,
                
                // Step 4: Dados Financiamento (manual ou confirma√ß√£o OCR)
                saldoDevedor: '',
                taxaNominal: '',
                prazoRestante: '',
                sistema: 'PRICE',
                seguroMensal: '',
                taxaAdminMensal: '',
                
                // Step 5: Recursos
                valorFGTS: '',
                capacidadeExtra: ''
            });

            const updateField = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            // ============================================
            // STEP 1: DADOS PESSOAIS
            // ============================================
            const Step1DadosPessoais = () => (
                <div className="card">
                    <div className="badge">
                        <i className="ph-fill ph-user"></i> Etapa 1 de 5
                    </div>
                    
                    <div className="card-title">
                        <i className="ph-fill ph-identification-card" style={{color: 'var(--gold-primary)'}}></i>
                        Seus Dados
                    </div>
                    <div className="card-subtitle">
                        Vamos come√ßar com suas informa√ß√µes b√°sicas
                    </div>

                    <div className="form-grid">
                        <div className="form-group" style={{gridColumn: 'span 2'}}>
                            <label className="form-label">Nome Completo *</label>
                            <input 
                                type="text" 
                                className="form-input" 
                                placeholder="Jo√£o Silva Santos"
                                value={formData.nome}
                                onChange={(e) => updateField('nome', e.target.value)}
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">WhatsApp *</label>
                            <input 
                                type="tel" 
                                className="form-input" 
                                placeholder="(11) 99999-9999"
                                value={formData.whatsapp}
                                onChange={(e) => updateField('whatsapp', e.target.value)}
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">Email (Opcional)</label>
                            <input 
                                type="email" 
                                className="form-input" 
                                placeholder="seu@email.com"
                                value={formData.email}
                                onChange={(e) => updateField('email', e.target.value)}
                            />
                        </div>
                    </div>

                    <div className="form-group" style={{marginBottom: '40px'}}>
                        <label className="form-label">Qual seu principal objetivo? *</label>
                        <div className="option-grid">
                            <div 
                                className={`option-card ${formData.objetivo === 'economia' ? 'selected' : ''}`}
                                onClick={() => updateField('objetivo', 'economia')}
                            >
                                <div className="option-icon">üí∞</div>
                                <div className="option-title">Economizar M√°ximo</div>
                                <div className="option-desc">Pagar menos juros ao longo do tempo</div>
                            </div>

                            <div 
                                className={`option-card ${formData.objetivo === 'quitar_rapido' ? 'selected' : ''}`}
                                onClick={() => updateField('objetivo', 'quitar_rapido')}
                            >
                                <div className="option-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                                <div className="option-title">Quitar R√°pido</div>
                                <div className="option-desc">Liberdade financeira o quanto antes</div>
                            </div>
                        </div>
                    </div>

                    <div className="btn-group">
                        <a href="/" className="btn btn-secondary">
                            <i className="ph-bold ph-arrow-left"></i>
                            Voltar
                        </a>
                        <button 
                            className="btn btn-primary"
                            disabled={!formData.nome || !formData.whatsapp || !formData.objetivo}
                            onClick={() => setStep(2)}
                        >
                            Pr√≥xima Etapa
                            <i className="ph-bold ph-arrow-right"></i>
                        </button>
                    </div>
                </div>
            );

            // ============================================
            // STEP 2: ESCOLHER M√âTODO
            // ============================================
            const Step2EscolhaMetodo = () => (
                <div className="card">
                    <div className="badge">
                        <i className="ph-fill ph-gear"></i> Etapa 2 de 5
                    </div>
                    
                    <div className="card-title">
                        <i className="ph-fill ph-path" style={{color: 'var(--gold-primary)'}}></i>
                        Escolha o M√©todo
                    </div>
                    <div className="card-subtitle">
                        Como voc√™ prefere inserir os dados do financiamento?
                    </div>

                    <div className="option-grid">
                        <div 
                            className={`option-card ${formData.metodo === 'ocr' ? 'selected' : ''}`}
                            onClick={() => updateField('metodo', 'ocr')}
                        >
                            <div className="option-icon">üì∏</div>
                            <div className="option-title">Tirar Foto (Recomendado)</div>
                            <div className="option-desc">Nossa IA extrai automaticamente os dados do app do banco</div>
                        </div>

                        <div 
                            className={`option-card ${formData.metodo === 'manual' ? 'selected' : ''}`}
                            onClick={() => updateField('metodo', 'manual')}
                        >
                            <div className="option-icon">‚úçÔ∏è</div>
                            <div className="option-title">Preencher Manual</div>
                            <div className="option-desc">Digite os dados manualmente (2 minutos)</div>
                        </div>
                    </div>

                    <div className="btn-group">
                        <button className="btn btn-secondary" onClick={() => setStep(1)}>
                            <i className="ph-bold ph-arrow-left"></i>
                            Voltar
                        </button>
                        <button 
                            className="btn btn-primary"
                            disabled={!formData.metodo}
                            onClick={() => {
                                if (formData.metodo === 'ocr') {
                                    setStep(2.5); // Escolher banco
                                } else {
                                    setStep(4); // Manual direto
                                }
                            }}
                        >
                            Pr√≥xima Etapa
                            <i className="ph-bold ph-arrow-right"></i>
                        </button>
                    </div>
                </div>
            );

            // ============================================
            // STEP 2.5: ESCOLHER BANCO (para OCR)
            // ============================================
            const Step25EscolherBanco = () => (
                <div className="card">
                    <div className="badge">
                        <i className="ph-fill ph-bank"></i> Etapa 2.5 de 5
                    </div>
                    
                    <div className="card-title">
                        <i className="ph-fill ph-bank" style={{color: 'var(--gold-primary)'}}></i>
                        Qual √© o seu banco?
                    </div>
                    <div className="card-subtitle">
                        Isso nos ajuda a processar a foto com mais precis√£o
                    </div>

                    <div className="form-group">
                        <label className="form-label">Selecione o banco *</label>
                        <select 
                            className="form-input form-select"
                            value={formData.banco}
                            onChange={(e) => updateField('banco', e.target.value)}
                        >
                            <option value="">Selecione...</option>
                            <option value="Caixa">Caixa Econ√¥mica Federal</option>
                            <option value="Ita√∫">Ita√∫ Unibanco</option>
                            <option value="Bradesco">Bradesco</option>
                            <option value="Santander">Santander</option>
                            <option value="Banco do Brasil">Banco do Brasil</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>

                    <div className="info-box">
                        <p>
                            <i className="ph-fill ph-lightbulb" style={{fontSize: '24px'}}></i>
                            <span>Na pr√≥xima tela, vamos te mostrar como tirar a foto ideal do app do {formData.banco || 'seu banco'}</span>
                        </p>
                    </div>

                    <div className="btn-group">
                        <button className="btn btn-secondary" onClick={() => setStep(2)}>
                            <i className="ph-bold ph-arrow-left"></i>
                            Voltar
                        </button>
                        <button 
                            className="btn btn-primary"
                            disabled={!formData.banco}
                            onClick={() => setStep(3)}
                        >
                            Pr√≥xima Etapa
                            <i className="ph-bold ph-arrow-right"></i>
                        </button>
                    </div>
                </div>
            );

            // ============================================
            // STEP 3: UPLOAD E OCR
            // ============================================
            const Step3Upload = () => {
                const handleFileChange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    // Preview
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        updateField('imagemPreview', event.target.result);
                    };
                    reader.readAsDataURL(file);
                    updateField('imagemContrato', file);

                    // OCR
                    setLoading(true);
                    setLoadingText('Processando imagem...');

                    try {
                        const { data: { text } } = await Tesseract.recognize(file, 'por', {
                            logger: (m) => {
                                if (m.status === 'recognizing text') {
                                    setLoadingText(`Extraindo dados... ${Math.round(m.progress * 100)}%`);
                                }
                            }
                        });

                        // Extrair dados (regex b√°sico)
                        const saldoMatch = text.match(/saldo.*?devedor.*?R?\$?\s*([0-9.,]+)/i);
                        const taxaMatch = text.match(/taxa.*?([0-9,]+)%/i);
                        const prazoMatch = text.match(/prazo.*?([0-9]+).*?mes/i);

                        if (saldoMatch) updateField('saldoDevedor', saldoMatch[1].replace(/\./g, '').replace(',', '.'));
                        if (taxaMatch) updateField('taxaNominal', taxaMatch[1].replace(',', '.'));
                        if (prazoMatch) updateField('prazoRestante', prazoMatch[1]);

                        setLoading(false);
                        setStep(4); // Ir para confirma√ß√£o
                    } catch (error) {
                        console.error('Erro no OCR:', error);
                        alert('Erro ao processar imagem. Tente novamente ou preencha manualmente.');
                        setLoading(false);
                    }
                };

                return (
                    <div className="card">
                        <div className="badge">
                            <i className="ph-fill ph-camera"></i> Etapa 3 de 5
                        </div>
                        
                        <div className="card-title">
                            <i className="ph-fill ph-image" style={{color: 'var(--gold-primary)'}}></i>
                            Tire uma Foto do Contrato
                        </div>
                        <div className="card-subtitle">
                            Abra o app do {formData.banco} e tire uma foto da tela de "Detalhes do Financiamento"
                        </div>

                        <div className="info-box">
                            <p>
                                <i className="ph-fill ph-info" style={{fontSize: '24px'}}></i>
                                <span><strong>Dica:</strong> Certifique-se que o saldo devedor, taxa de juros e prazo est√£o vis√≠veis e leg√≠veis</span>
                            </p>
                        </div>

                        <input 
                            type="file" 
                            accept="image/*" 
                            capture="environment"
                            id="fileInput" 
                            style={{display: 'none'}}
                            onChange={handleFileChange}
                        />

                        <label htmlFor="fileInput" className="upload-zone">
                            {formData.imagemPreview ? (
                                <div className="upload-preview">
                                    <img src={formData.imagemPreview} alt="Preview" />
                                </div>
                            ) : (
                                <>
                                    <div className="upload-icon">
                                        <i className="ph-fill ph-camera-plus"></i>
                                    </div>
                                    <div className="upload-text">Clique para tirar foto ou selecionar arquivo</div>
                                    <div className="upload-hint">Formatos: JPG, PNG (m√°x. 10MB)</div>
                                </>
                            )}
                        </label>

                        <div className="btn-group">
                            <button className="btn btn-secondary" onClick={() => setStep(2.5)}>
                                <i className="ph-bold ph-arrow-left"></i>
                                Voltar
                            </button>
                            <button 
                                className="btn btn-secondary"
                                onClick={() => {
                                    updateField('metodo', 'manual');
                                    setStep(4);
                                }}
                            >
                                Preencher Manual
                            </button>
                        </div>
                    </div>
                );
            };

            // ============================================
            // STEP 4: DADOS FINANCIAMENTO
            // ============================================
            const Step4DadosFinanciamento = () => (
                <div className="card">
                    <div className="badge">
                        <i className="ph-fill ph-house"></i> Etapa 4 de 5
                    </div>
                    
                    <div className="card-title">
                        <i className="ph-fill ph-file-text" style={{color: 'var(--gold-primary)'}}></i>
                        {formData.metodo === 'ocr' ? 'Confirme os Dados Extra√≠dos' : 'Dados do Financiamento'}
                    </div>
                    <div className="card-subtitle">
                        {formData.metodo === 'ocr' 
                            ? 'Verifique se os dados foram extra√≠dos corretamente e corrija se necess√°rio' 
                            : 'Preencha os dados do seu contrato de financiamento'}
                    </div>

                    <div className="form-grid">
                        {formData.metodo !== 'ocr' && (
                            <div className="form-group" style={{gridColumn: 'span 2'}}>
                                <label className="form-label">Banco *</label>
                                <select 
                                    className="form-input form-select"
                                    value={formData.banco}
                                    onChange={(e) => updateField('banco', e.target.value)}
                                >
                                    <option value="">Selecione...</option>
                                    <option value="Caixa">Caixa Econ√¥mica Federal</option>
                                    <option value="Ita√∫">Ita√∫ Unibanco</option>
                                    <option value="Bradesco">Bradesco</option>
                                    <option value="Santander">Santander</option>
                                    <option value="Banco do Brasil">Banco do Brasil</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                        )}

                        <div className="form-group" style={{gridColumn: 'span 2'}}>
                            <label className="form-label">Saldo Devedor (R$) *</label>
                            <input 
                                type="text" 
                                className="form-input" 
                                placeholder="Ex: 250000"
                                value={formData.saldoDevedor}
                                onChange={(e) => updateField('saldoDevedor', e.target.value.replace(/\D/g, ''))}
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">Taxa de Juros (% ao ano) *</label>
                            <input 
                                type="text" 
                                className="form-input" 
                                placeholder="Ex: 9.75"
                                value={formData.taxaNominal}
                                onChange={(e) => updateField('taxaNominal', e.target.value)}
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">Prazo Restante (meses) *</label>
                            <input 
                                type="number" 
                                className="form-input" 
                                placeholder="Ex: 360"
                                value={formData.prazoRestante}
                                onChange={(e) => updateField('prazoRestante', e.target.value)}
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">Sistema *</label>
                            <select 
                                className="form-input form-select"
                                value={formData.sistema}
                                onChange={(e) => updateField('sistema', e.target.value)}
                            >
                                <option value="PRICE">PRICE</option>
                                <option value="SAC">SAC</option>
                            </select>
                        </div>

                        <div className="form-group">
                            <label className="form-label">Seguro Mensal (R$)</label>
                            <input 
                                type="text" 
                                className="form-input" 
                                placeholder="Ex: 15.84"
                                value={formData.seguroMensal}
                                onChange={(e) => updateField('seguroMensal', e.target.value)}
                            />
                        </div>

                        <div className="form-group" style={{gridColumn: 'span 2'}}>
                            <label className="form-label">Taxa de Administra√ß√£o Mensal (R$)</label>
                            <input 
                                type="text" 
                                className="form-input" 
                                placeholder="Ex: 25.00"
                                value={formData.taxaAdminMensal}
                                onChange={(e) => updateField('taxaAdminMensal', e.target.value)}
                            />
                        </div>
                    </div>

                    <div className="btn-group">
                        <button className="btn btn-secondary" onClick={() => setStep(formData.metodo === 'ocr' ? 3 : 2)}>
                            <i className="ph-bold ph-arrow-left"></i>
                            Voltar
                        </button>
                        <button 
                            className="btn btn-primary"
                            disabled={!formData.banco || !formData.saldoDevedor || !formData.taxaNominal || !formData.prazoRestante}
                            onClick={() => setStep(5)}
                        >
                            Pr√≥xima Etapa
                            <i className="ph-bold ph-arrow-right"></i>
                        </button>
                    </div>
                </div>
            );

            // ============================================
            // STEP 5: RECURSOS
            // ============================================
            const Step5Recursos = () => {
                const handleSubmit = async () => {
                    setLoading(true);
                    setLoadingText('Enviando seus dados...');

                    const payload = {
                        nome: formData.nome,
                        email: formData.email || null,
                        whatsapp: formData.whatsapp,
                        banco: formData.banco,
                        objetivo: formData.objetivo,
                        financiamento: {
                            saldo_devedor: parseFloat(formData.saldoDevedor),
                            taxa_nominal: parseFloat(formData.taxaNominal) / 100,
                            prazo_restante: parseInt(formData.prazoRestante),
                            sistema: formData.sistema,
                            tr_mensal: 0.0015,
                            seguro_mensal: parseFloat(formData.seguroMensal) || 0,
                            taxa_admin_mensal: parseFloat(formData.taxaAdminMensal) || 0
                        },
                        recursos: {
                            valor_fgts: parseFloat(formData.valorFGTS) || 0,
                            capacidade_extra: parseFloat(formData.capacidadeExtra) || 0,
                            tem_reserva_emergencia: false,
                            trabalha_clt: false
                        }
                    };

                    try {
                        const response = await fetch(`${API_URL}/api/cliente`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(payload)
                        });

                        const data = await response.json();

                        if (response.ok && data.sucesso) {
                            setLoading(false);
                            setSubmitted(true);
                        } else {
                            throw new Error(data.mensagem || 'Erro ao enviar');
                        }
                    } catch (error) {
                        console.error('Erro:', error);
                        alert('Erro ao enviar. Tente novamente ou entre em contato via WhatsApp.');
                        setLoading(false);
                    }
                };

                return (
                    <div className="card">
                        <div className="badge">
                            <i className="ph-fill ph-wallet"></i> Etapa 5 de 5
                        </div>
                        
                        <div className="card-title">
                            <i className="ph-fill ph-coins" style={{color: 'var(--gold-primary)'}}></i>
                            Recursos Dispon√≠veis
                        </div>
                        <div className="card-subtitle">
                            Informe os recursos que voc√™ pode usar para amortizar
                        </div>

                        <div className="form-grid">
                            <div className="form-group">
                                <label className="form-label">Valor FGTS Dispon√≠vel (R$)</label>
                                <input 
                                    type="text" 
                                    className="form-input" 
                                    placeholder="Ex: 25000"
                                    value={formData.valorFGTS}
                                    onChange={(e) => updateField('valorFGTS', e.target.value.replace(/\D/g, ''))}
                                />
                            </div>

                            <div className="form-group">
                                <label className="form-label">Capacidade Extra Mensal (R$)</label>
                                <input 
                                    type="text" 
                                    className="form-input" 
                                    placeholder="Ex: 500"
                                    value={formData.capacidadeExtra}
                                    onChange={(e) => updateField('capacidadeExtra', e.target.value.replace(/\D/g, ''))}
                                />
                            </div>
                        </div>

                        <div className="info-box">
                            <p>
                                <i className="ph-fill ph-info" style={{fontSize: '24px'}}></i>
                                <span>Quanto mais recursos voc√™ alocar, maior ser√° a economia. Mas n√£o se preocupe, vamos te mostrar o melhor caminho!</span>
                            </p>
                        </div>

                        <div className="btn-group">
                            <button className="btn btn-secondary" onClick={() => setStep(4)}>
                                <i className="ph-bold ph-arrow-left"></i>
                                Voltar
                            </button>
                            <button 
                                className="btn btn-primary"
                                onClick={handleSubmit}
                                style={{minWidth: '200px'}}
                            >
                                <i className="ph-bold ph-paper-plane-tilt"></i>
                                Enviar An√°lise
                            </button>
                        </div>
                    </div>
                );
            };

            // ============================================
            // TELA DE SUCESSO
            // ============================================
            const SuccessScreen = () => {
                const whatsappLink = `https://wa.me/5583991014456?text=Ol√°! Acabei de enviar minha an√°lise pelo site.%0A%0ANome: ${formData.nome}%0AObjetivo: ${formData.objetivo === 'economia' ? 'Economizar M√°ximo' : 'Quitar R√°pido'}%0A%0AQuero entender melhor os resultados!`;

                return (
                    <div className="card">
                        <div className="success-screen">
                            <div className="success-icon">üéâ</div>
                            <h1 className="success-title">Perfeito, {formData.nome.split(' ')[0]}!</h1>
                            <p className="success-text">
                                Recebemos sua solicita√ß√£o! Nossa equipe vai analisar seu caso e entrar em contato 
                                em at√© <strong style={{color: 'var(--gold-primary)'}}>24 horas</strong> com uma 
                                an√°lise completa e personalizada do seu financiamento.
                            </p>

                            <a href={whatsappLink} target="_blank" rel="noopener noreferrer" className="btn btn-primary" style={{minWidth: '280px', marginBottom: '20px'}}>
                                <i className="ph-fill ph-whatsapp-logo"></i>
                                Falar Agora no WhatsApp
                            </a>

                            <a href="/" className="btn btn-secondary" style={{minWidth: '280px'}}>
                                Voltar para o In√≠cio
                            </a>
                        </div>
                    </div>
                );
            };

            // ============================================
            // LOADING OVERLAY
            // ============================================
            const LoadingOverlay = () => (
                <div className="loading-overlay">
                    <div className="loading-spinner"></div>
                    <div className="loading-text">{loadingText}</div>
                    <div className="loading-subtext">Isso pode levar alguns segundos...</div>
                </div>
            );

            // ============================================
            // PROGRESS BAR
            // ============================================
            const ProgressBar = () => {
                const steps = [
                    { num: 1, label: 'Dados' },
                    { num: 2, label: 'M√©todo' },
                    { num: 3, label: 'Upload' },
                    { num: 4, label: 'Financ.' },
                    { num: 5, label: 'Recursos' }
                ];

                const currentStep = Math.floor(step);
                const progress = ((currentStep - 1) / (steps.length - 1)) * 100;

                return (
                    <div className="progress-wrapper">
                        <div className="progress-steps">
                            <div className="progress-line">
                                <div className="progress-line-fill" style={{width: `${progress}%`}}></div>
                            </div>
                            {steps.map((s) => (
                                <div key={s.num} className={`step ${currentStep === s.num ? 'active' : ''} ${currentStep > s.num ? 'completed' : ''}`}>
                                    <div className="step-circle">
                                        {currentStep > s.num ? '‚úì' : s.num}
                                    </div>
                                    <div className="step-label">{s.label}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // ============================================
            // RENDER
            // ============================================
            if (submitted) {
                return (
                    <div className="container">
                        <SuccessScreen />
                    </div>
                );
            }

            return (
                <>
                    {loading && <LoadingOverlay />}
                    
                    <div className="container">
                        <div className="header">
                            <img src="https://meuecofin.com.br/wp-content/uploads/2025/02/Branco-PNG-e1740599425113.png" alt="Ecofin Logo" />
                            <h1>An√°lise Gratuita de Financiamento</h1>
                            <p>Descubra quanto voc√™ pode economizar em menos de 5 minutos</p>
                        </div>

                        {!submitted && <ProgressBar />}

                        {step === 1 && <Step1DadosPessoais />}
                        {step === 2 && <Step2EscolhaMetodo />}
                        {step === 2.5 && <Step25EscolherBanco />}
                        {step === 3 && <Step3Upload />}
                        {step === 4 && <Step4DadosFinanciamento />}
                        {step === 5 && <Step5Recursos />}
                    </div>
                </>
            );
        }

        // ============================================
        // RENDER APP
        // ============================================
        ReactDOM.render(<FormularioCliente />, document.getElementById('root'));
    </script>
</body>
</html>
