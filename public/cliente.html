<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoFin - An√°lise Gratuita</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #000 0%, #1B4D3E 100%); color: white; min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; padding: 2rem; }
        .glass { background: rgba(212, 168, 60, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(212, 168, 60, 0.2); border-radius: 1rem; padding: 2rem; }
        .input-field { background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(212, 168, 60, 0.3); color: white; padding: 0.75rem; border-radius: 0.5rem; width: 100%; transition: all 0.3s; }
        .input-field:focus { background: rgba(255, 255, 255, 0.12); border-color: #D4A83C; outline: none; box-shadow: 0 0 0 3px rgba(212, 168, 60, 0.1); }
        .btn-primary { background: linear-gradient(135deg, #D4A83C 0%, #E5B94D 100%); color: #000; padding: 1rem 2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 700; transition: all 0.3s; font-size: 1rem; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(212, 168, 60, 0.4); }
        .btn-secondary { background: rgba(255, 255, 255, 0.1); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; border: 1px solid rgba(212, 168, 60, 0.3); cursor: pointer; font-weight: 600; }
        .option-card { padding: 2rem; border-radius: 1rem; cursor: pointer; transition: all 0.3s; background: rgba(255, 255, 255, 0.05); border: 2px solid transparent; }
        .option-card:hover { background: rgba(212, 168, 60, 0.1); transform: translateY(-5px); }
        .option-card.selected { background: rgba(212, 168, 60, 0.2); border-color: #D4A83C; }
        .step-indicator { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; }
        .step { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; border: 3px solid rgba(212, 168, 60, 0.3); background: rgba(0, 0, 0, 0.3); transition: all 0.3s; }
        .step.active { background: #D4A83C; color: #000; border-color: #D4A83C; transform: scale(1.1); }
        .step.completed { background: #1B4D3E; border-color: #1B4D3E; color: white; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease-out; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .spinner { border: 4px solid rgba(212, 168, 60, 0.1); border-top: 4px solid #D4A83C; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        const API_URL = 'https://ecofin-app-production.up.railway.app';

        function FormularioCliente() {
            const [step, setStep] = useState(1);
            const [loading, setLoading] = useState(false);
            const [submitted, setSubmitted] = useState(false);

            const [formData, setFormData] = useState({
                nome: '',
                whatsapp: '',
                email: '',
                banco: '',
                objetivo: '',
                saldoDevedor: 0,
                taxaNominal: 0,
                prazoRestante: 0,
                sistema: 'PRICE',
                valorFGTS: 0,
                capacidadeExtra: 0
            });

            const updateField = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));

            const handleSubmit = async () => {
                setLoading(true);
                
                // TRANSFORMAR PARA FORMATO DA API
                const payload = {
                    nome: formData.nome,
                    email: formData.email || null,
                    whatsapp: formData.whatsapp,
                    banco: formData.banco,
                    objetivo: formData.objetivo,
                    financiamento: {
                        saldo_devedor: formData.saldoDevedor,
                        taxa_nominal: formData.taxaNominal,
                        prazo_restante: formData.prazoRestante,
                        sistema: formData.sistema,
                        tr_mensal: 0.0015,
                        seguro_mensal: 25,
                        taxa_admin_mensal: 50
                    },
                    recursos: {
                        valor_fgts: formData.valorFGTS,
                        capacidade_extra: formData.capacidadeExtra,
                        tem_reserva_emergencia: false,
                        trabalha_clt: false
                    }
                };
                
                console.log('üì§ Enviando para API:', payload);
                
                try {
                    const response = await fetch(`${API_URL}/api/cliente`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    console.log('üì• Status:', response.status);
                    
                    const data = await response.json();
                    console.log('üì• Resposta:', data);
                    
                    if (data.sucesso) {
                        setSubmitted(true);
                    } else {
                        throw new Error('Erro ao enviar');
                    }
                } catch (err) {
                    console.error('‚ùå Erro:', err);
                    alert('Erro ao enviar. Tente novamente.');
                } finally {
                    setLoading(false);
                }
            };

            if (submitted) {
                return (
                    <div className="container">
                        <div className="glass animate-in" style={{textAlign: 'center', padding: '3rem', maxWidth: '600px', margin: '5rem auto'}}>
                            <div style={{fontSize: '5rem', marginBottom: '1.5rem'}}>üéâ</div>
                            <h1 style={{fontSize: '2.5rem', fontWeight: '700', color: '#D4A83C', marginBottom: '1rem'}}>
                                Perfeito, {formData.nome}!
                            </h1>
                            <p style={{fontSize: '1.25rem', color: '#ccc', marginBottom: '2rem', lineHeight: '1.8'}}>
                                Recebemos sua solicita√ß√£o! Victor analisar√° seu caso e entrar√° em contato 
                                em at√© <strong style={{color: '#D4A83C'}}>24 horas</strong> com uma an√°lise 
                                completa e personalizada.
                            </p>
                            <a href="/" style={{display: 'inline-block', textDecoration: 'none'}}>
                                <button className="btn-primary">Voltar para o In√≠cio</button>
                            </a>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <div style={{textAlign: 'center', marginBottom: '3rem'}} className="animate-in">
                        <div style={{fontSize: '5rem', marginBottom: '1rem'}}>üîë</div>
                        <h1 style={{fontSize: '3rem', fontWeight: '700', color: '#D4A83C', marginBottom: '0.5rem'}}>
                            An√°lise Gratuita EcoFin
                        </h1>
                        <p style={{fontSize: '1.25rem', color: '#ccc'}}>
                            Descubra quanto voc√™ pode economizar no seu financiamento
                        </p>
                    </div>

                    <div className="step-indicator">
                        {[1, 2, 3].map(s => (
                            <div key={s} className={`step ${step === s ? 'active' : ''} ${step > s ? 'completed' : ''}`}>
                                {step > s ? '‚úì' : s}
                            </div>
                        ))}
                    </div>

                    <div className="glass animate-in">
                        {/* STEP 1: Dados Pessoais */}
                        {step === 1 && (
                            <div>
                                <h2 style={{fontSize: '2rem', fontWeight: '700', color: '#D4A83C', marginBottom: '2rem'}}>
                                    üìã Seus Dados
                                </h2>
                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem'}}>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Nome Completo *</label>
                                        <input type="text" className="input-field" placeholder="Jos√© da Silva" value={formData.nome} onChange={(e) => updateField('nome', e.target.value)} />
                                    </div>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>WhatsApp *</label>
                                        <input type="tel" className="input-field" placeholder="(11) 99999-9999" value={formData.whatsapp} onChange={(e) => updateField('whatsapp', e.target.value)} />
                                    </div>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Email</label>
                                        <input type="email" className="input-field" placeholder="seu@email.com" value={formData.email} onChange={(e) => updateField('email', e.target.value)} />
                                    </div>
                                </div>
                                <div style={{marginTop: '1.5rem'}}>
                                    <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.75rem', fontWeight: '600'}}>Qual seu principal objetivo? *</label>
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem'}}>
                                        {[
                                            { value: 'quitar_rapido', icon: 'üèÉ‚Äç‚ôÇÔ∏è', label: 'Quitar R√°pido', desc: 'Liberdade financeira' },
                                            { value: 'economia', icon: 'üí∞', label: 'Economizar M√°ximo', desc: 'Pagar menos juros' }
                                        ].map(opt => (
                                            <div key={opt.value} className={`option-card ${formData.objetivo === opt.value ? 'selected' : ''}`} onClick={() => updateField('objetivo', opt.value)}>
                                                <div style={{fontSize: '3rem', marginBottom: '0.5rem'}}>{opt.icon}</div>
                                                <div style={{fontWeight: '700', color: 'white', marginBottom: '0.25rem'}}>{opt.label}</div>
                                                <div style={{fontSize: '0.875rem', color: '#999'}}>{opt.desc}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div style={{display: 'flex', justifyContent: 'flex-end', marginTop: '2rem', paddingTop: '2rem', borderTop: '1px solid rgba(212, 168, 60, 0.2)'}}>
                                    <button onClick={() => setStep(2)} className="btn-primary" disabled={!formData.nome || !formData.whatsapp || !formData.objetivo}>
                                        Pr√≥xima Etapa ‚Üí
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* STEP 2: Dados do Financiamento */}
                        {step === 2 && (
                            <div>
                                <h2 style={{fontSize: '2rem', fontWeight: '700', color: '#D4A83C', marginBottom: '2rem'}}>
                                    üìÑ Dados do Financiamento
                                </h2>
                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem'}}>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Banco *</label>
                                        <input type="text" className="input-field" placeholder="Caixa, Ita√∫..." value={formData.banco} onChange={(e) => updateField('banco', e.target.value)} />
                                    </div>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Sistema *</label>
                                        <select className="input-field" value={formData.sistema} onChange={(e) => updateField('sistema', e.target.value)}>
                                            <option value="SAC">SAC</option>
                                            <option value="PRICE">PRICE</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Saldo Devedor (R$) *</label>
                                        <input type="number" className="input-field" placeholder="250000" value={formData.saldoDevedor || ''} onChange={(e) => updateField('saldoDevedor', parseFloat(e.target.value) || 0)} />
                                    </div>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Taxa (% ao ano) *</label>
                                        <input type="number" step="0.01" className="input-field" placeholder="9.75" value={formData.taxaNominal * 100 || ''} onChange={(e) => updateField('taxaNominal', (parseFloat(e.target.value) || 0) / 100)} />
                                    </div>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Prazo Restante (meses) *</label>
                                        <input type="number" className="input-field" placeholder="360" value={formData.prazoRestante || ''} onChange={(e) => updateField('prazoRestante', parseInt(e.target.value) || 0)} />
                                    </div>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Valor FGTS (R$)</label>
                                        <input type="number" className="input-field" placeholder="25000" value={formData.valorFGTS || ''} onChange={(e) => updateField('valorFGTS', parseFloat(e.target.value) || 0)} />
                                    </div>
                                    <div>
                                        <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontWeight: '600'}}>Capacidade Extra (R$/m√™s)</label>
                                        <input type="number" className="input-field" placeholder="500" value={formData.capacidadeExtra || ''} onChange={(e) => updateField('capacidadeExtra', parseFloat(e.target.value) || 0)} />
                                    </div>
                                </div>
                                <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '2rem', paddingTop: '2rem', borderTop: '1px solid rgba(212, 168, 60, 0.2)'}}>
                                    <button onClick={() => setStep(1)} className="btn-secondary">‚Üê Voltar</button>
                                    <button onClick={() => setStep(3)} className="btn-primary" disabled={!formData.banco || !formData.saldoDevedor || !formData.taxaNominal || !formData.prazoRestante}>
                                        Pr√≥xima Etapa ‚Üí
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* STEP 3: Resumo */}
                        {step === 3 && (
                            <div>
                                <h2 style={{fontSize: '2rem', fontWeight: '700', color: '#D4A83C', marginBottom: '2rem'}}>
                                    ‚úÖ Resumo da Solicita√ß√£o
                                </h2>
                                
                                <div style={{background: 'rgba(212, 168, 60, 0.1)', border: '1px solid #D4A83C', borderRadius: '0.5rem', padding: '2rem', marginBottom: '2rem'}}>
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1.5rem', fontSize: '0.875rem'}}>
                                        <div><p style={{color: '#999'}}>Nome:</p><p style={{fontWeight: '700', color: 'white'}}>{formData.nome}</p></div>
                                        <div><p style={{color: '#999'}}>WhatsApp:</p><p style={{fontWeight: '700', color: 'white'}}>{formData.whatsapp}</p></div>
                                        <div><p style={{color: '#999'}}>Banco:</p><p style={{fontWeight: '700', color: 'white'}}>{formData.banco}</p></div>
                                        <div><p style={{color: '#999'}}>Saldo:</p><p style={{fontWeight: '700', color: '#D4A83C'}}>R$ {formData.saldoDevedor?.toLocaleString('pt-BR')}</p></div>
                                        <div><p style={{color: '#999'}}>Taxa:</p><p style={{fontWeight: '700', color: 'white'}}>{(formData.taxaNominal * 100).toFixed(2)}% a.a.</p></div>
                                        <div><p style={{color: '#999'}}>Prazo:</p><p style={{fontWeight: '700', color: 'white'}}>{formData.prazoRestante} meses</p></div>
                                    </div>
                                </div>

                                <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '2rem', paddingTop: '2rem', borderTop: '1px solid rgba(212, 168, 60, 0.2)'}}>
                                    <button onClick={() => setStep(2)} className="btn-secondary">‚Üê Voltar</button>
                                    <button onClick={handleSubmit} className="btn-primary" disabled={loading} style={{fontSize: '1.125rem', padding: '1.25rem 2.5rem'}}>
                                        {loading ? 'Enviando...' : 'üöÄ Enviar Solicita√ß√£o'}
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<FormularioCliente />, document.getElementById('root'));
    </script>
</body>
</html>
