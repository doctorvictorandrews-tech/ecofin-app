<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoFin - An√°lise Gratuita</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        :root {
            --bg-body: #050505;
            --bg-surface: #0F0F0F;
            --gold-primary: #D9890D;
            --gold-hover: #F59E0B;
            --text-primary: #FFFFFF;
            --text-secondary: #C4C4C4; 
            --border-light: rgba(255, 255, 255, 0.1);
            --success: #10B981;
            --font-body: 'Inter', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-body);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .bg-blob {
            position: fixed; filter: blur(120px); z-index: -1; opacity: 0.15;
            animation: blobMove 20s infinite alternate ease-in-out; border-radius: 50%;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: var(--gold-primary); }
        .blob-2 { bottom: -20%; right: -20%; width: 60vw; height: 60vw; background: #5a3a00; animation-delay: -10s; }
        @keyframes blobMove { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }

        .container { max-width: 900px; margin: 0 auto; padding: 2rem; position: relative; z-index: 2; }
        
        .glass {
            background: rgba(15, 15, 15, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: 24px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .logo { max-width: 180px; height: auto; margin: 0 auto 3rem; display: block; }
        
        .step-indicator { display: flex; justify-content: center; gap: 1rem; margin-bottom: 3rem; }
        
        .step { 
            width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-weight: 700; border: 3px solid var(--border-light); 
            background: var(--bg-surface); transition: all 0.3s; font-size: 18px;
        }
        
        .step.active { 
            background: var(--gold-primary); color: #000; border-color: var(--gold-primary); 
            transform: scale(1.15); box-shadow: 0 0 20px rgba(217,137,13,0.5);
        }
        
        .step.completed { background: var(--success); border-color: var(--success); color: white; }

        h1 { font-size: 2.5rem; font-weight: 800; text-align: center; margin-bottom: 1rem; color: white; letter-spacing: -1px; }
        .subtitle { text-align: center; color: var(--text-secondary); margin-bottom: 3rem; font-size: 1.1rem; }
        
        .input-field { 
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-light); 
            color: white; padding: 1rem; border-radius: 12px; width: 100%; 
            transition: all 0.3s; font-size: 16px; font-family: var(--font-body);
        }
        
        .input-field:focus { 
            background: rgba(255, 255, 255, 0.08); border-color: var(--gold-primary); 
            outline: none; box-shadow: 0 0 0 4px rgba(217, 168, 60, 0.1); 
        }
        
        .input-label {
            display: block; color: var(--gold-primary); margin-bottom: 0.75rem; 
            font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        .input-group { margin-bottom: 1.5rem; }
        
        .btn-primary { 
            background: var(--gold-primary); color: #000; padding: 1.25rem 3rem; 
            border-radius: 12px; border: none; cursor: pointer; font-weight: 800; 
            transition: all 0.3s; font-size: 16px; width: 100%; text-transform: uppercase;
            letter-spacing: 1px; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        
        .btn-primary:hover { 
            transform: translateY(-3px); background: var(--gold-hover); 
            box-shadow: 0 10px 40px rgba(217, 168, 60, 0.4); 
        }
        
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-secondary { 
            background: transparent; color: var(--text-secondary); padding: 1rem 2rem; 
            border-radius: 12px; border: 1px solid var(--border-light); cursor: pointer; 
            font-weight: 600; transition: all 0.3s;
        }
        
        .btn-secondary:hover { border-color: var(--gold-primary); color: var(--gold-primary); }
        
        .grid-2 { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        @media(min-width: 768px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
        
        .option-card { 
            padding: 2rem; border-radius: 16px; cursor: pointer; transition: all 0.3s; 
            background: rgba(255, 255, 255, 0.03); border: 2px solid var(--border-light); 
            margin-bottom: 1.5rem;
        }
        
        .option-card:hover { 
            background: rgba(217, 137, 13, 0.1); transform: translateY(-5px); 
            border-color: var(--gold-primary); box-shadow: 0 10px 30px rgba(217,137,13,0.2);
        }
        
        .option-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 12px; }
        .option-description { color: var(--text-secondary); font-size: 0.95rem; }
        
        .success-message {
            background: rgba(16, 185, 129, 0.1); border: 2px solid var(--success);
            border-radius: 16px; padding: 2rem; text-align: center;
        }
        
        .success-message i { font-size: 4rem; color: var(--success); margin-bottom: 1rem; }
        .success-message h2 { color: white; margin-bottom: 1rem; }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1); border: 2px solid #ef4444;
            border-radius: 16px; padding: 2rem; margin-top: 2rem;
        }
        
        .error-message h3 { color: #ef4444; margin-bottom: 1rem; }
        .error-message pre { 
            background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; 
            overflow-x: auto; font-size: 12px; color: #fca5a5;
        }
        
        .spinner { 
            border: 4px solid rgba(217, 137, 13, 0.1); border-top: 4px solid var(--gold-primary); 
            border-radius: 50%; width: 50px; height: 50px; 
            animation: spin 1s linear infinite; margin: 2rem auto; 
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease-out; }
    </style>
</head>
<body>
    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>
    
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        function App() {
            const [step, setStep] = useState(1);
            const [formData, setFormData] = useState({
                nome: '', email: '', whatsapp: '', banco: '', sistema: 'PRICE',
                objetivo: 'economia', saldoDevedor: 0, taxaNominal: 0, prazoRestante: 0,
                valorParcelaAtual: 0, valorFGTS: 0, capacidadeExtra: 0, taxaAdmin: 25, seguroMensal: 50
            });
            const [uploading, setUploading] = useState(false);
            const [success, setSuccess] = useState(false);
            const [errorDetails, setErrorDetails] = useState(null);

            const updateField = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));

            const handleSubmit = async () => {
                setUploading(true);
                setErrorDetails(null);
                
                // Validar e converter valores
                const saldoDevedor = parseFloat(formData.saldoDevedor);
                const taxaAnual = parseFloat(formData.taxaNominal);
                const prazoMeses = parseInt(formData.prazoRestante);
                const valorFgts = parseFloat(formData.valorFGTS) || 0;
                const capacidadeExtra = parseFloat(formData.capacidadeExtra) || 0;
                
                // Valida√ß√µes b√°sicas
                if (!saldoDevedor || saldoDevedor <= 0) {
                    alert('Saldo devedor inv√°lido');
                    setUploading(false);
                    return;
                }
                
                if (!taxaAnual || taxaAnual <= 0 || taxaAnual >= 1) {
                    alert('Taxa deve estar entre 0 e 1 (ex: 0.12 para 12%)');
                    setUploading(false);
                    return;
                }
                
                if (!prazoMeses || prazoMeses <= 0) {
                    alert('Prazo inv√°lido');
                    setUploading(false);
                    return;
                }
                
                // Preparar payload EXATAMENTE como a API espera
                const payload = {
                    nome: formData.nome,
                    email: formData.email || "nao-informado@ecofin.com",
                    telefone: formData.whatsapp,
                    dados_financiamento: {
                        saldo_devedor: saldoDevedor,
                        taxa_anual: taxaAnual,
                        prazo_meses: prazoMeses,
                        sistema: formData.sistema || "PRICE"
                    },
                    recursos_disponiveis: {
                        valor_fgts: valorFgts,
                        capacidade_extra_mensal: capacidadeExtra
                    }
                };

                console.log('üì§ Enviando payload:', JSON.stringify(payload, null, 2));

                try {
                    const response = await fetch('https://ecofin-app-production.up.railway.app/otimizar', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    console.log('üì• Status da resposta:', response.status);

                    if (response.ok) {
                        const data = await response.json();
                        console.log('‚úÖ Resposta da API:', data);
                        setSuccess(true);
                        setStep(5);
                    } else {
                        // Erro da API
                        const errorData = await response.json().catch(() => ({ detail: 'Erro desconhecido' }));
                        console.error('‚ùå Erro da API:', errorData);
                        setErrorDetails({
                            status: response.status,
                            message: errorData.detail || JSON.stringify(errorData),
                            payload: payload
                        });
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro de rede:', error);
                    setErrorDetails({
                        status: 'NETWORK_ERROR',
                        message: error.message,
                        payload: payload
                    });
                }
                
                setUploading(false);
            };

            return (
                <div className="container">
                    <div className="glass animate-in">
                        <img src="https://meuecofin.com.br/wp-content/uploads/2025/02/Branco-PNG-e1740599425113.png" alt="EcoFin" className="logo" />
                        
                        <div className="step-indicator">
                            <div className={`step ${step >= 1 ? 'completed' : ''} ${step === 1 ? 'active' : ''}`}>1</div>
                            <div className={`step ${step >= 2 ? 'completed' : ''} ${step === 2 ? 'active' : ''}`}>2</div>
                            <div className={`step ${step >= 3 ? 'completed' : ''} ${step === 3 ? 'active' : ''}`}>3</div>
                            <div className={`step ${step >= 4 ? 'completed' : ''} ${step === 4 ? 'active' : ''}`}>4</div>
                        </div>

                        {step === 1 && (
                            <div>
                                <h1>An√°lise Gratuita</h1>
                                <p className="subtitle">Descubra quanto voc√™ pode economizar</p>
                                
                                <div className="input-group">
                                    <label className="input-label">Nome Completo *</label>
                                    <input type="text" className="input-field" placeholder="Maria Silva"
                                        value={formData.nome} onChange={(e) => updateField('nome', e.target.value)} />
                                </div>

                                <div className="grid-2">
                                    <div className="input-group">
                                        <label className="input-label">Email</label>
                                        <input type="email" className="input-field" placeholder="maria@email.com"
                                            value={formData.email} onChange={(e) => updateField('email', e.target.value)} />
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">WhatsApp *</label>
                                        <input type="tel" className="input-field" placeholder="(83) 99999-9999"
                                            value={formData.whatsapp} onChange={(e) => updateField('whatsapp', e.target.value)} />
                                    </div>
                                </div>

                                <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '2rem'}}>
                                    <button className="btn-secondary" disabled>‚Üê Voltar</button>
                                    <button className="btn-primary" onClick={() => setStep(2)} 
                                        disabled={!formData.nome || !formData.whatsapp}>
                                        Pr√≥ximo <i className="ph-bold ph-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        )}

                        {step === 2 && (
                            <div>
                                <h1>Como voc√™ prefere enviar?</h1>
                                <p className="subtitle">Escolha a forma mais f√°cil</p>

                                <div className="option-card" onClick={() => setStep(3)}>
                                    <div className="option-title">
                                        <i className="ph-duotone ph-keyboard" style={{fontSize: '2rem', color: 'var(--gold-primary)'}}></i>
                                        Digitar Manualmente
                                    </div>
                                    <p className="option-description">Digite saldo devedor, taxa e prazo</p>
                                </div>

                                <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '2rem'}}>
                                    <button className="btn-secondary" onClick={() => setStep(1)}>‚Üê Voltar</button>
                                </div>
                            </div>
                        )}

                        {step === 3 && (
                            <div>
                                <h1>Dados do Financiamento</h1>
                                <p className="subtitle">Digite as informa√ß√µes do seu contrato</p>

                                <div className="grid-2">
                                    <div className="input-group">
                                        <label className="input-label">Banco</label>
                                        <input type="text" className="input-field" placeholder="Caixa, Ita√∫..."
                                            value={formData.banco} onChange={(e) => updateField('banco', e.target.value)} />
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">Sistema *</label>
                                        <select className="input-field" value={formData.sistema}
                                            onChange={(e) => updateField('sistema', e.target.value)}>
                                            <option value="PRICE">PRICE</option>
                                            <option value="SAC">SAC</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="grid-2">
                                    <div className="input-group">
                                        <label className="input-label">Saldo Devedor (R$) *</label>
                                        <input type="number" className="input-field" placeholder="300000"
                                            value={formData.saldoDevedor || ''} 
                                            onChange={(e) => updateField('saldoDevedor', parseFloat(e.target.value) || 0)} />
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">Taxa (% ao ano) *</label>
                                        <input type="number" step="0.01" className="input-field" placeholder="12.00"
                                            value={(formData.taxaNominal * 100) || ''} 
                                            onChange={(e) => updateField('taxaNominal', (parseFloat(e.target.value) || 0) / 100)} />
                                        <small style={{color: 'var(--text-secondary)', fontSize: '0.85rem', marginTop: '0.5rem', display: 'block'}}>
                                            Digite a taxa anual (ex: 12 para 12% a.a.)
                                        </small>
                                    </div>
                                </div>

                                <div className="grid-2">
                                    <div className="input-group">
                                        <label className="input-label">Prazo Restante (meses) *</label>
                                        <input type="number" className="input-field" placeholder="420"
                                            value={formData.prazoRestante || ''} 
                                            onChange={(e) => updateField('prazoRestante', parseInt(e.target.value) || 0)} />
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">Valor da Parcela (R$)</label>
                                        <input type="number" className="input-field" placeholder="3500"
                                            value={formData.valorParcelaAtual || ''} 
                                            onChange={(e) => updateField('valorParcelaAtual', parseFloat(e.target.value) || 0)} />
                                    </div>
                                </div>

                                <div className="grid-2" style={{marginTop: '1rem'}}>
                                    <div className="input-group">
                                        <label className="input-label">Valor FGTS (R$)</label>
                                        <input type="number" className="input-field" placeholder="30000"
                                            value={formData.valorFGTS || ''} 
                                            onChange={(e) => updateField('valorFGTS', parseFloat(e.target.value) || 0)} />
                                    </div>
                                    <div className="input-group">
                                        <label className="input-label">Capacidade Extra (R$/m√™s)</label>
                                        <input type="number" className="input-field" placeholder="1000"
                                            value={formData.capacidadeExtra || ''} 
                                            onChange={(e) => updateField('capacidadeExtra', parseFloat(e.target.value) || 0)} />
                                    </div>
                                </div>

                                <div style={{display: 'flex', justifyContent: 'space-between', marginTop: '2rem'}}>
                                    <button className="btn-secondary" onClick={() => setStep(2)}>‚Üê Voltar</button>
                                    <button className="btn-primary" onClick={() => setStep(4)}
                                        disabled={!formData.saldoDevedor || !formData.taxaNominal || !formData.prazoRestante}>
                                        Continuar <i className="ph-bold ph-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        )}

                        {step === 4 && !success && (
                            <div>
                                <h1>Confirme seus dados</h1>
                                <p className="subtitle">Revise antes de enviar</p>

                                <div style={{background: 'rgba(255,255,255,0.03)', padding: '2rem', borderRadius: '16px', marginBottom: '2rem'}}>
                                    <h3 style={{color: 'var(--gold-primary)', marginBottom: '1.5rem'}}>Resumo</h3>
                                    <div style={{display: 'grid', gap: '1rem'}}>
                                        <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                            <span style={{color: 'var(--text-secondary)'}}>Nome:</span>
                                            <strong>{formData.nome}</strong>
                                        </div>
                                        <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                            <span style={{color: 'var(--text-secondary)'}}>WhatsApp:</span>
                                            <strong>{formData.whatsapp}</strong>
                                        </div>
                                        <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                            <span style={{color: 'var(--text-secondary)'}}>Saldo Devedor:</span>
                                            <strong>R$ {formData.saldoDevedor.toLocaleString('pt-BR')}</strong>
                                        </div>
                                        <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                            <span style={{color: 'var(--text-secondary)'}}>Taxa:</span>
                                            <strong>{(formData.taxaNominal * 100).toFixed(2)}% a.a.</strong>
                                        </div>
                                        <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                            <span style={{color: 'var(--text-secondary)'}}>Prazo:</span>
                                            <strong>{formData.prazoRestante} meses</strong>
                                        </div>
                                    </div>
                                </div>

                                {uploading ? (
                                    <div>
                                        <div className="spinner"></div>
                                        <p style={{textAlign: 'center', color: 'var(--text-secondary)'}}>
                                            Processando sua an√°lise...
                                        </p>
                                    </div>
                                ) : (
                                    <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                        <button className="btn-secondary" onClick={() => setStep(3)}>‚Üê Voltar</button>
                                        <button className="btn-primary" onClick={handleSubmit}>
                                            <i className="ph-bold ph-check-circle"></i> Enviar An√°lise
                                        </button>
                                    </div>
                                )}
                                
                                {errorDetails && (
                                    <div className="error-message">
                                        <h3>‚ùå Erro ao enviar</h3>
                                        <p style={{color: 'var(--text-secondary)', marginBottom: '1rem'}}>
                                            Status: {errorDetails.status}
                                        </p>
                                        <p style={{color: 'var(--text-secondary)', marginBottom: '1rem'}}>
                                            {errorDetails.message}
                                        </p>
                                        <details>
                                            <summary style={{cursor: 'pointer', color: 'var(--gold-primary)', marginBottom: '1rem'}}>
                                                Ver detalhes t√©cnicos
                                            </summary>
                                            <pre>{JSON.stringify(errorDetails.payload, null, 2)}</pre>
                                        </details>
                                        <button className="btn-primary" onClick={() => setErrorDetails(null)} style={{marginTop: '1rem'}}>
                                            Tentar Novamente
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {step === 5 && success && (
                            <div className="success-message">
                                <i className="ph-fill ph-check-circle"></i>
                                <h2>An√°lise Enviada com Sucesso!</h2>
                                <p style={{color: 'var(--text-secondary)', marginBottom: '2rem'}}>
                                    Em breve entraremos em contato com sua estrat√©gia personalizada.
                                </p>
                                <button className="btn-primary" 
                                    onClick={() => window.open('https://wa.me/5583991014456', '_blank')}>
                                    <i className="ph-bold ph-whatsapp-logo"></i> Falar no WhatsApp
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
