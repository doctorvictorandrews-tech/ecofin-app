<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin | Ecofin</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Manrope:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-body: #050505; --bg-surface: #0F0F0F; --bg-surface-light: #161616;
            --gold-primary: #D9890D; --gold-hover: #F59E0B; --text-primary: #FFFFFF;
            --text-secondary: #C4C4C4; --border-light: rgba(255, 255, 255, 0.1);
            --success: #10B981; --danger: #EF4444; --info: #3B82F6;
            --font-sans: 'Manrope', sans-serif; --font-body: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg-body); color: var(--text-primary); font-family: var(--font-body); }
        .bg-blob { position: fixed; filter: blur(120px); z-index: -1; opacity: 0.15; border-radius: 50%; }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: var(--gold-primary); }
        .container { width: 95%; max-width: 1400px; margin: 0 auto; padding: 20px 0; position: relative; z-index: 2; }
        .header { background: var(--bg-surface); border: 1px solid var(--border-light); border-radius: 16px; padding: 30px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .header img { height: 40px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 700; transition: 0.3s; }
        .btn-primary { background: var(--gold-primary); color: #000; }
        .btn-logout { background: transparent; border: 1px solid var(--border-light); color: white; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--bg-surface); border: 1px solid var(--border-light); border-radius: 16px; padding: 25px; }
        .stat-value { font-size: 36px; font-weight: 800; font-family: var(--font-mono); margin-bottom: 5px; }
        .clientes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .cliente-card { background: var(--bg-surface); border: 1px solid var(--border-light); border-radius: 16px; padding: 25px; cursor: pointer; transition: 0.3s; }
        .cliente-card:hover { border-color: var(--gold-primary); transform: translateY(-5px); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 999; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .modal { background: var(--bg-surface); border: 1px solid var(--border-light); border-radius: 20px; max-width: 1200px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 30px; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; }
        .tabs { display: flex; gap: 5px; background: #1A1A1A; padding: 5px; border-radius: 12px; margin-bottom: 30px; }
        .tab { flex: 1; padding: 12px 20px; background: transparent; border: none; color: var(--text-secondary); font-weight: 600; border-radius: 8px; cursor: pointer; }
        .tab.active { background: var(--gold-primary); color: #000; }
        .table { width: 100%; border-collapse: collapse; }
        .table th { padding: 15px; font-size: 12px; text-transform: uppercase; color: var(--text-secondary); border-bottom: 1px solid var(--border-light); text-align: left; }
        .table td { padding: 15px; font-family: var(--font-mono); border-bottom: 1px solid var(--border-light); }
        .login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-card { background: var(--bg-surface); border: 1px solid var(--border-light); border-radius: 20px; padding: 60px 50px; max-width: 450px; text-align: center; }
        .login-input { width: 100%; background: #1A1A1A; border: 1px solid var(--border-light); color: white; padding: 18px; border-radius: 10px; font-family: var(--font-mono); font-size: 18px; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="bg-blob blob-1"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_URL = 'https://ecofin-app-production.up.railway.app';
        const SENHA = 'ecofin2025';

        const formatCurrency = (v) => new Intl.NumberFormat('pt-BR', {style: 'currency', currency: 'BRL'}).format(v);

        function App() {
            const [auth, setAuth] = useState(false);
            const [senha, setSenha] = useState('');
            const [clientes, setClientes] = useState([]);
            const [selected, setSelected] = useState(null);
            const [analise, setAnalise] = useState(null);
            const [tab, setTab] = useState('visao');

            const login = (e) => {
                e.preventDefault();
                if (senha === SENHA) setAuth(true);
            };

            const loadClientes = async () => {
                try {
                    const res = await fetch(`${API_URL}/api/clientes?senha=${SENHA}`);
                    const data = await res.json();
                    if (data.sucesso) setClientes(data.clientes);
                } catch (e) { console.error(e); }
            };

            const loadAnalise = async (id) => {
                try {
                    const res = await fetch(`${API_URL}/api/analise/${id}`);
                    const data = await res.json();
                    if (data.sucesso) setAnalise(data);
                } catch (e) { console.error(e); }
            };

            useEffect(() => { if (auth) loadClientes(); }, [auth]);

            if (!auth) {
                return (
                    <div className="login-screen">
                        <div className="login-card">
                            <img src="https://meuecofin.com.br/wp-content/uploads/2025/02/Branco-PNG-e1740599425113.png" style={{height: '50px', margin: '0 auto 30px'}} />
                            <h1 style={{marginBottom: '40px'}}>Painel Admin</h1>
                            <form onSubmit={login}>
                                <input type="password" className="login-input" placeholder="Senha" value={senha} onChange={(e) => setSenha(e.target.value)} />
                                <button type="submit" className="btn btn-primary" style={{width: '100%', padding: '18px'}}>Entrar</button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <div className="header">
                        <img src="https://meuecofin.com.br/wp-content/uploads/2025/02/Branco-PNG-e1740599425113.png" />
                        <button className="btn btn-logout" onClick={() => setAuth(false)}>Sair</button>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-value">{clientes.length}</div>
                            <div style={{fontSize: '12px', color: 'var(--text-secondary)'}}>CLIENTES</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value" style={{color: 'var(--gold-primary)'}}>
                                {formatCurrency(clientes.reduce((s,c) => s + (c.financiamento?.saldo_devedor || 0), 0))}
                            </div>
                            <div style={{fontSize: '12px', color: 'var(--text-secondary)'}}>TOTAL EM DÍVIDAS</div>
                        </div>
                    </div>

                    <div className="clientes-grid">
                        {clientes.map(c => (
                            <div key={c.id} className="cliente-card" onClick={() => {setSelected(c); loadAnalise(c.id);}}>
                                <h3 style={{marginBottom: '10px'}}>{c.nome}</h3>
                                <div style={{fontSize: '14px', color: 'var(--text-secondary)', marginBottom: '15px'}}>{c.banco}</div>
                                <div style={{fontSize: '20px', fontWeight: '700', color: 'var(--gold-primary)'}}>
                                    {formatCurrency(c.financiamento?.saldo_devedor || 0)}
                                </div>
                            </div>
                        ))}
                    </div>

                    {selected && analise && (
                        <div className="modal-overlay" onClick={() => {setSelected(null); setAnalise(null);}}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2>{selected.nome}</h2>
                                    <button className="btn btn-logout" onClick={() => {setSelected(null); setAnalise(null);}}>Fechar</button>
                                </div>
                                <div style={{padding: '30px'}}>
                                    <div className="tabs">
                                        <button className={`tab ${tab === 'visao' ? 'active' : ''}`} onClick={() => setTab('visao')}>Visão Geral</button>
                                        <button className={`tab ${tab === 'tabela' ? 'active' : ''}`} onClick={() => setTab('tabela')}>Tabela</button>
                                    </div>

                                    {tab === 'visao' && (
                                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px'}}>
                                            <div style={{textAlign: 'center', padding: '20px', background: '#1A1A1A', borderRadius: '12px'}}>
                                                <div style={{fontSize: '28px', fontWeight: '800', color: 'var(--gold-primary)'}}>
                                                    {formatCurrency(analise.estrategia_otimizada.economia)}
                                                </div>
                                                <div style={{fontSize: '12px', color: 'var(--text-secondary)', marginTop: '5px'}}>ECONOMIA</div>
                                            </div>
                                            <div style={{textAlign: 'center', padding: '20px', background: '#1A1A1A', borderRadius: '12px'}}>
                                                <div style={{fontSize: '28px', fontWeight: '800', color: 'var(--success)'}}>
                                                    {analise.estrategia_otimizada.reducao_prazo}
                                                </div>
                                                <div style={{fontSize: '12px', color: 'var(--text-secondary)', marginTop: '5px'}}>MESES REDUZIDOS</div>
                                            </div>
                                            <div style={{textAlign: 'center', padding: '20px', background: '#1A1A1A', borderRadius: '12px'}}>
                                                <div style={{fontSize: '28px', fontWeight: '800', color: 'white'}}>
                                                    {analise.estrategia_otimizada.roi.toFixed(1)}%
                                                </div>
                                                <div style={{fontSize: '12px', color: 'var(--text-secondary)', marginTop: '5px'}}>ROI</div>
                                            </div>
                                        </div>
                                    )}

                                    {tab === 'tabela' && (
                                        <div style={{maxHeight: '500px', overflow: 'auto'}}>
                                            <table className="table">
                                                <thead>
                                                    <tr>
                                                        <th>Mês</th>
                                                        <th>Juros</th>
                                                        <th>Amortização</th>
                                                        <th>Parcela</th>
                                                        <th>Saldo</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {analise.estrategia_otimizada.simulacao_completa.map(m => (
                                                        <tr key={m.mes}>
                                                            <td>{m.mes}</td>
                                                            <td>{formatCurrency(m.juros)}</td>
                                                            <td>{formatCurrency(m.amortizacao)}</td>
                                                            <td>{formatCurrency(m.parcela)}</td>
                                                            <td>{formatCurrency(m.saldo_devedor)}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
