<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoFin - Painel Administrativo</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="/motor_ecofin.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #000; color: white; }
        .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        .glass { background: rgba(212, 168, 60, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(212, 168, 60, 0.2); border-radius: 1rem; }
        .card { background: rgba(27, 77, 62, 0.1); padding: 2rem; border-radius: 1rem; margin-bottom: 1.5rem; border: 1px solid rgba(212, 168, 60, 0.2); }
        .btn-primary { background: linear-gradient(135deg, #D4A83C 0%, #E5B94D 100%); color: #000; padding: 1rem 2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 700; transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(212, 168, 60, 0.4); }
        .btn-secondary { background: #1B4D3E; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; margin-left: 0.5rem; }
        .btn-danger { background: #ef4444; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; margin-left: 0.5rem; }
        .btn-danger:hover { background: #dc2626; }
        .input-field { background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(212, 168, 60, 0.3); color: white; padding: 0.75rem; border-radius: 0.5rem; width: 100%; }
        .input-field:focus { background: rgba(255, 255, 255, 0.12); border-color: #D4A83C; outline: none; }
        .metric { text-align: center; padding: 1.5rem; }
        .metric-value { font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; }
        .metric-label { color: #D4A83C; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 1px; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
        .data-table thead { background: rgba(212, 168, 60, 0.2); position: sticky; top: 0; z-index: 10; }
        .data-table th { padding: 1rem 0.75rem; text-align: right; font-weight: 700; color: #D4A83C; border-bottom: 2px solid #D4A83C; }
        .data-table th:first-child { text-align: left; }
        .data-table td { padding: 0.75rem; text-align: right; border-bottom: 1px solid rgba(212, 168, 60, 0.1); }
        .data-table td:first-child { text-align: left; font-weight: 600; }
        .data-table tr:hover { background: rgba(212, 168, 60, 0.05); }
        .year-header { background: rgba(212, 168, 60, 0.15) !important; cursor: pointer; user-select: none; }
        .year-header:hover { background: rgba(212, 168, 60, 0.25) !important; }
        .year-header td { font-size: 1rem; font-weight: 700; color: #D4A83C; padding: 1rem !important; }
        .positive { color: #10b981; font-weight: 600; }
        .negative { color: #ef4444; font-weight: 600; }
        .warning { color: #f59e0b; font-weight: 600; }
        .recomendacao { background: linear-gradient(135deg, rgba(212, 168, 60, 0.2) 0%, rgba(27, 77, 62, 0.2) 100%); border: 2px solid #D4A83C; padding: 2.5rem; border-radius: 1rem; margin: 2rem 0; }
        .justificativa { background: rgba(255, 255, 255, 0.03); padding: 1.5rem; border-left: 4px solid #D4A83C; border-radius: 0.5rem; margin: 1rem 0; line-height: 1.8; }
        .section-title { font-size: 2rem; font-weight: 700; margin-bottom: 1.5rem; color: #D4A83C; }
        .toolbar { display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .collapse-icon { display: inline-block; margin-right: 0.5rem; transition: transform 0.3s; }
        .collapsed { transform: rotate(-90deg); }
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: #1a1a1a; padding: 2rem; border-radius: 1rem; max-width: 600px; width: 90%; border: 2px solid #D4A83C; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.6s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const SENHA_ADMIN = "ecofin2025";
        const formato = (v) => new Intl.NumberFormat('pt-BR', {style: 'currency', currency: 'BRL'}).format(v);

        // ==================== EXPORTAR EXCEL ====================
        function exportarExcel(estrategia, cliente) {
            const wb = XLSX.utils.book_new();
            
            const wsData = [
                ['AN√ÅLISE COMPLETA ECOFIN - MOTOR DEFINITIVO'],
                ['Cliente:', cliente.nome],
                ['Data:', new Date().toLocaleDateString('pt-BR')],
                [],
                ['M√™s', 'Ano', 'Saldo Inicial', 'Juros', 'Amort. Base', 'Amort. Extra', 'Parcela', 'Saldo Final', '% Quitado', 'Juros Acum.', 'Amort. Acum.'],
            ];

            estrategia.detalhes.forEach(m => {
                wsData.push([
                    m.mes, m.ano, m.saldoInicial, m.juros, m.amortizacaoBase, m.amortizacaoExtra,
                    m.parcela, m.saldoFinal, m.percentualQuitado, m.jurosAcumulados, m.amortizadoAcumulado
                ]);
            });

            const ws = XLSX.utils.aoa_to_sheet(wsData);
            ws['!cols'] = [{wch: 6}, {wch: 6}, {wch: 15}, {wch: 12}, {wch: 12}, {wch: 12}, {wch: 12}, {wch: 15}, {wch: 10}, {wch: 15}, {wch: 15}];

            XLSX.utils.book_append_sheet(wb, ws, 'An√°lise');
            XLSX.writeFile(wb, `EcoFin_${cliente.nome.replace(/\s+/g, '_')}.xlsx`);
        }

        // ==================== LISTA CLIENTES ====================
        function ListaClientes({ onSelectCliente, onDeleteCliente }) {
            const [clientes, setClientes] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const fetchClientes = async () => {
                    try {
                        const response = await fetch('https://ecofin-app-production.up.railway.app/api/clientes');
                        const data = await response.json();
                        if (data.sucesso) setClientes(data.clientes);
                    } catch (err) {
                        const local = JSON.parse(localStorage.getItem('ecofin_clientes') || '[]');
                        setClientes(local);
                    } finally {
                        setLoading(false);
                    }
                };
                fetchClientes();
            }, []);

            const handleDelete = async (id, nome) => {
                if (!confirm(`Tem certeza que deseja excluir ${nome}?`)) return;
                
                try {
                    await fetch(`https://ecofin-app-production.up.railway.app/api/cliente/${id}`, { method: 'DELETE' });
                } catch (err) {
                    const local = JSON.parse(localStorage.getItem('ecofin_clientes') || '[]');
                    const filtrados = local.filter(c => c.id !== id);
                    localStorage.setItem('ecofin_clientes', JSON.stringify(filtrados));
                }
                
                setClientes(clientes.filter(c => c.id !== id));
                alert('Cliente exclu√≠do com sucesso!');
            };

            if (loading) {
                return <div style={{textAlign: 'center', padding: '3rem', color: '#D4A83C'}}>
                    <div style={{fontSize: '3rem', marginBottom: '1rem'}}>‚è≥</div>
                    <p>Carregando clientes...</p>
                </div>;
            }

            if (clientes.length === 0) {
                return <div style={{textAlign: 'center', padding: '3rem'}}>
                    <div style={{fontSize: '4rem', marginBottom: '1rem'}}>üì≠</div>
                    <h2 style={{color: '#D4A83C'}}>Nenhum cliente cadastrado</h2>
                </div>;
            }

            return (
                <div style={{display: 'grid', gap: '1rem'}}>
                    {clientes.map(cliente => (
                        <div key={cliente.id} className="glass" style={{padding: '1.5rem', transition: 'all 0.3s'}}>
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                <div style={{flex: 1, cursor: 'pointer'}} onClick={() => onSelectCliente(cliente)}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '1rem'}}>
                                        <div>
                                            <h3 style={{fontSize: '1.25rem', fontWeight: '700', color: '#D4A83C'}}>{cliente.nome}</h3>
                                            <p style={{color: '#9ca3af', fontSize: '0.875rem'}}>{cliente.whatsapp}</p>
                                        </div>
                                        <span style={{background: '#D4A83C', color: '#000', padding: '0.25rem 0.75rem', borderRadius: '999px', fontSize: '0.75rem', fontWeight: '700', height: 'fit-content'}}>
                                            {(cliente.objetivo || 'economia').replace('_', ' ').toUpperCase()}
                                        </span>
                                    </div>
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))', gap: '1rem', fontSize: '0.875rem'}}>
                                        <div><p style={{color: '#9ca3af'}}>Banco</p><p style={{fontWeight: '600', color: 'white'}}>{cliente.banco}</p></div>
                                        <div><p style={{color: '#9ca3af'}}>Saldo</p><p style={{fontWeight: '600', color: 'white'}}>R$ {cliente.saldoDevedor?.toLocaleString('pt-BR')}</p></div>
                                        <div><p style={{color: '#9ca3af'}}>Taxa</p><p style={{fontWeight: '600', color: 'white'}}>{((cliente.taxaNominal||cliente.taxaAnual)*100).toFixed(2)}%</p></div>
                                        <div><p style={{color: '#9ca3af'}}>Prazo</p><p style={{fontWeight: '600', color: 'white'}}>{cliente.prazoRestante}m</p></div>
                                    </div>
                                </div>
                                <button onClick={(e) => { e.stopPropagation(); handleDelete(cliente.id, cliente.nome); }} className="btn-danger" style={{marginLeft: '1rem'}}>
                                    üóëÔ∏è Excluir
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        // ==================== MODAL EDI√á√ÉO ====================
        function ModalEdicao({ cliente, onSave, onClose }) {
            const [dados, setDados] = useState(cliente);

            const handleSave = async () => {
                try {
                    await fetch(`https://ecofin-app-production.up.railway.app/api/cliente/${cliente.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dados)
                    });
                } catch (err) {
                    const local = JSON.parse(localStorage.getItem('ecofin_clientes') || '[]');
                    const idx = local.findIndex(c => c.id === cliente.id);
                    if (idx >= 0) {
                        local[idx] = dados;
                        localStorage.setItem('ecofin_clientes', JSON.stringify(local));
                    }
                }
                onSave(dados);
            };

            return (
                <div className="modal">
                    <div className="modal-content">
                        <h2 style={{color: '#D4A83C', marginBottom: '1.5rem'}}>‚úèÔ∏è Editar Dados</h2>
                        <div style={{display: 'grid', gap: '1rem', maxHeight: '60vh', overflowY: 'auto', padding: '0.5rem'}}>
                            <div>
                                <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontSize: '0.875rem'}}>Saldo Devedor (R$)</label>
                                <input type="number" className="input-field" value={dados.saldoDevedor || ''} onChange={(e) => setDados({...dados, saldoDevedor: parseFloat(e.target.value) || 0})} />
                            </div>
                            <div>
                                <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontSize: '0.875rem'}}>Taxa (% ao ano)</label>
                                <input type="number" step="0.01" className="input-field" value={((dados.taxaNominal || dados.taxaAnual) * 100).toFixed(2)} onChange={(e) => setDados({...dados, taxaNominal: parseFloat(e.target.value) / 100})} />
                            </div>
                            <div>
                                <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontSize: '0.875rem'}}>Prazo Restante (meses)</label>
                                <input type="number" className="input-field" value={dados.prazoRestante || ''} onChange={(e) => setDados({...dados, prazoRestante: parseInt(e.target.value) || 0})} />
                            </div>
                            <div>
                                <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontSize: '0.875rem'}}>FGTS Dispon√≠vel (R$)</label>
                                <input type="number" className="input-field" value={dados.valorFGTS || ''} onChange={(e) => setDados({...dados, valorFGTS: parseFloat(e.target.value) || 0})} />
                            </div>
                            <div>
                                <label style={{display: 'block', color: '#D4A83C', marginBottom: '0.5rem', fontSize: '0.875rem'}}>Capacidade Extra (R$/m√™s)</label>
                                <input type="number" className="input-field" value={dados.capacidadeExtra || ''} onChange={(e) => setDados({...dados, capacidadeExtra: parseFloat(e.target.value) || 0})} />
                            </div>
                        </div>
                        <div style={{display: 'flex', justifyContent: 'flex-end', gap: '1rem', marginTop: '1.5rem'}}>
                            <button onClick={onClose} className="btn-secondary">Cancelar</button>
                            <button onClick={handleSave} className="btn-primary">üíæ Salvar e Recalcular</button>
                        </div>
                    </div>
                </div>
            );
        }

        // ==================== TABELA COMPLETA ====================
        function TabelaCompleta({ estrategia, estrategiaOriginal }) {
            const [anosExpandidos, setAnosExpandidos] = useState([1, 2]);

            const motor = new MotorEcoFin({ saldoDevedor: 1, taxaNominal: 0.01, prazoRestante: 1 });
            const anosDados = motor.agruparPorAno(estrategia.detalhes);

            const toggleAno = (ano) => {
                setAnosExpandidos(prev => prev.includes(ano) ? prev.filter(a => a !== ano) : [...prev, ano]);
            };

            return (
                <div>
                    <div className="toolbar">
                        <button onClick={() => setAnosExpandidos(anosDados.map(a => a.ano))} className="btn-primary">‚ñº Expandir Todos</button>
                        <button onClick={() => setAnosExpandidos([])} className="btn-secondary">‚ñ∂ Colapsar Todos</button>
                    </div>
                    <div style={{overflowX: 'auto'}}>
                        <table className="data-table">
                            <thead>
                                <tr>
                                    <th>M√™s</th>
                                    <th>Saldo Inicial</th>
                                    <th>Juros</th>
                                    <th>Amort. Base</th>
                                    <th>Amort. Extra</th>
                                    <th>Parcela</th>
                                    <th>Saldo Final</th>
                                    <th>% Quitado</th>
                                    <th>Juros Acum.</th>
                                    <th>Amort. Acum.</th>
                                </tr>
                            </thead>
                            <tbody>
                                {anosDados.map(ano => (
                                    <React.Fragment key={ano.ano}>
                                        <tr className="year-header" onClick={() => toggleAno(ano.ano)}>
                                            <td colSpan="10">
                                                <span className={`collapse-icon ${!anosExpandidos.includes(ano.ano) ? 'collapsed' : ''}`}>‚ñº</span>
                                                <strong>Ano {ano.ano}</strong> ({ano.meses.length} meses) - 
                                                Saldo: {formato(ano.saldoInicial)} ‚Üí {formato(ano.saldoFinal)} | 
                                                Total Pago: {formato(ano.totalPago)}
                                            </td>
                                        </tr>
                                        {anosExpandidos.includes(ano.ano) && ano.meses.map(mes => (
                                            <tr key={mes.mes}>
                                                <td>{mes.mes}</td>
                                                <td>{formato(mes.saldoInicial)}</td>
                                                <td className="negative">{formato(mes.juros)}</td>
                                                <td className="positive">{formato(mes.amortizacaoBase)}</td>
                                                <td className="warning">{formato(mes.amortizacaoExtra)}</td>
                                                <td><strong>{formato(mes.parcela)}</strong></td>
                                                <td>{formato(mes.saldoFinal)}</td>
                                                <td>{mes.percentualQuitado.toFixed(1)}%</td>
                                                <td className="negative">{formato(mes.jurosAcumulados)}</td>
                                                <td className="positive">{formato(mes.amortizadoAcumulado)}</td>
                                            </tr>
                                        ))}
                                    </React.Fragment>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // ==================== AN√ÅLISE COMPLETA ====================
        function AnaliseCompleta({ cliente: clienteInicial, onVoltar }) {
            const [cliente, setCliente] = useState(clienteInicial);
            const [mostrarEdicao, setMostrarEdicao] = useState(false);
            const [tabAtiva, setTabAtiva] = useState('visao-geral');

            const motor = new MotorEcoFin({
                saldoDevedor: cliente.saldoDevedor,
                taxaNominal: cliente.taxaNominal || cliente.taxaAnual,
                prazoRestante: cliente.prazoRestante,
                sistema: cliente.sistema || 'PRICE',
                tr: cliente.tr || 0.0015,
                seguroMensal: cliente.seguroMensal || 25,
                taxaAdm: cliente.taxaAdm || 50,
                valorFGTS: cliente.valorFGTS || 0,
                capacidadeExtra: cliente.capacidadeExtra || 0,
                objetivo: cliente.objetivo || 'economia',
                trabalhaCLT: cliente.trabalhaCLT || false
            });

            const recursos = {
                valorFGTS: cliente.valorFGTS || 0,
                capacidadeExtra: cliente.capacidadeExtra || 0,
                temReserva: cliente.temReservaEmergencia || false
            };

            const estrategiaOtima = motor.otimizarAmortizacao(cliente.objetivo || 'economia', recursos);
            const estrategiaOriginal = motor.simularCompleto();
            const justificativa = motor.gerarJustificativa(estrategiaOtima, estrategiaOriginal);

            const handleSaveEdicao = (novosDados) => {
                setCliente(novosDados);
                setMostrarEdicao(false);
                alert('‚úÖ Dados salvos! Recalculando...');
            };

            return (
                <div className="container">
                    {mostrarEdicao && <ModalEdicao cliente={cliente} onSave={handleSaveEdicao} onClose={() => setMostrarEdicao(false)} />}

                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem'}}>
                        <h1 style={{fontSize: '2rem', fontWeight: '700', color: '#D4A83C'}}>An√°lise - {cliente.nome}</h1>
                        <div>
                            <button onClick={() => setMostrarEdicao(true)} className="btn-secondary">‚úèÔ∏è Editar Dados</button>
                            <button onClick={onVoltar} className="btn-primary" style={{marginLeft: '1rem'}}>‚Üê Voltar</button>
                        </div>
                    </div>

                    <div className="glass" style={{padding: '1rem', marginBottom: '2rem', display: 'flex', gap: '1rem', flexWrap: 'wrap'}}>
                        {[
                            {id: 'visao-geral', label: 'üìä Vis√£o Geral'},
                            {id: 'tabela-completa', label: 'üìã Tabela Completa'}
                        ].map(tab => (
                            <button key={tab.id} onClick={() => setTabAtiva(tab.id)}
                                style={{
                                    padding: '0.75rem 1.5rem', borderRadius: '0.5rem', border: 'none',
                                    background: tabAtiva === tab.id ? '#D4A83C' : 'transparent',
                                    color: tabAtiva === tab.id ? '#000' : '#D4A83C',
                                    cursor: 'pointer', fontWeight: '700', transition: 'all 0.3s'
                                }}>
                                {tab.label}
                            </button>
                        ))}
                    </div>

                    {tabAtiva === 'visao-geral' && (
                        <div className="animate-in">
                            <div className="card">
                                <h2 style={{color: '#D4A83C', marginBottom: '1.5rem'}}>Situa√ß√£o Atual</h2>
                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '2rem'}}>
                                    <div className="metric">
                                        <div className="metric-value negative">{formato(cliente.saldoDevedor)}</div>
                                        <div className="metric-label">Saldo Devedor</div>
                                    </div>
                                    <div className="metric">
                                        <div className="metric-value warning">{((cliente.taxaNominal||cliente.taxaAnual)*100).toFixed(2)}%</div>
                                        <div className="metric-label">Taxa ao Ano</div>
                                    </div>
                                    <div className="metric">
                                        <div className="metric-value" style={{color: '#1B4D3E'}}>{(cliente.prazoRestante/12).toFixed(1)}</div>
                                        <div className="metric-label">Anos Restantes</div>
                                    </div>
                                    <div className="metric">
                                        <div className="metric-value negative">{formato(estrategiaOriginal.totalJuros)}</div>
                                        <div className="metric-label">Total em Juros</div>
                                    </div>
                                </div>
                            </div>

                            <div className="recomendacao">
                                <div style={{fontSize: '3rem', marginBottom: '1rem'}}>üîë</div>
                                <h3 style={{fontSize: '2rem', fontWeight: '700', color: '#D4A83C', marginBottom: '1rem'}}>
                                    {justificativa.titulo}
                                </h3>
                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '2rem', marginTop: '2rem'}}>
                                    <div className="metric">
                                        <div className="metric-value positive">{formato(estrategiaOtima.economia)}</div>
                                        <div className="metric-label">Economia Total</div>
                                    </div>
                                    <div className="metric">
                                        <div className="metric-value" style={{color: '#1B4D3E'}}>{estrategiaOtima.reducaoPrazo || 0}</div>
                                        <div className="metric-label">Meses Economizados</div>
                                    </div>
                                    <div className="metric">
                                        <div className="metric-value" style={{color: '#D4A83C'}}>{(estrategiaOtima.prazoMeses/12).toFixed(1)}</div>
                                        <div className="metric-label">Anos para Quitar</div>
                                    </div>
                                </div>
                                <div style={{marginTop: '2rem', padding: '1.5rem', background: 'rgba(0,0,0,0.3)', borderRadius: '0.5rem'}}>
                                    <p style={{fontSize: '1.125rem', lineHeight: '1.8'}}>
                                        <strong style={{color: '#D4A83C'}}>Resumo:</strong> 
                                        {estrategiaOtima.fgtsUsado > 0 && ` Usar ${formato(estrategiaOtima.fgtsUsado)} do FGTS + `}
                                        Amortizar {formato(estrategiaOtima.amortMensal)}/m√™s = 
                                        Economia de {formato(estrategiaOtima.economia)} em {((estrategiaOtima.reducaoPrazo||0)/12).toFixed(1)} anos a menos!
                                    </p>
                                </div>
                            </div>

                            <div className="justificativa">
                                <h4 style={{color: '#D4A83C', marginBottom: '1rem'}}>Por que essa √© a melhor estrat√©gia?</h4>
                                <p style={{marginBottom: '1rem'}}>{justificativa.paragrafo1}</p>
                                <p style={{marginBottom: '1rem'}}>{justificativa.paragrafo2}</p>
                                <p style={{marginBottom: '1rem'}}>{justificativa.paragrafo3}</p>
                                <p style={{marginBottom: '1rem'}}>{justificativa.paragrafo4}</p>
                                <div style={{background: 'rgba(212, 168, 60, 0.1)', padding: '1rem', borderRadius: '0.5rem', marginTop: '1.5rem'}}>
                                    <p>{justificativa.insight}</p>
                                </div>
                            </div>

                            <button onClick={() => exportarExcel(estrategiaOtima, cliente)} className="btn-primary" style={{width: '100%', marginTop: '2rem'}}>
                                üì• Exportar Excel Completo
                            </button>
                        </div>
                    )}

                    {tabAtiva === 'tabela-completa' && (
                        <div className="animate-in">
                            <div className="card">
                                <h2 style={{color: '#D4A83C', marginBottom: '1.5rem'}}>üìã Tabela M√™s a M√™s</h2>
                                <TabelaCompleta estrategia={estrategiaOtima} estrategiaOriginal={estrategiaOriginal} />
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // ==================== APP ====================
        function App() {
            const [autenticado, setAutenticado] = useState(false);
            const [view, setView] = useState('lista');
            const [clienteSelecionado, setClienteSelecionado] = useState(null);

            useEffect(() => {
                const auth = sessionStorage.getItem('ecofin_autenticado');
                if (auth === 'true') {
                    setAutenticado(true);
                } else {
                    const senha = prompt('üîê Senha de acesso:');
                    if (senha === SENHA_ADMIN) {
                        sessionStorage.setItem('ecofin_autenticado', 'true');
                        setAutenticado(true);
                    } else {
                        alert('‚ùå Senha incorreta!');
                        window.location.href = '/';
                    }
                }
            }, []);

            if (!autenticado) {
                return <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100vh'}}>
                    <div style={{textAlign: 'center'}}>
                        <div style={{fontSize: '4rem', marginBottom: '1rem'}}>üîí</div>
                        <p style={{color: '#D4A83C', fontSize: '1.25rem'}}>Verificando acesso...</p>
                    </div>
                </div>;
            }

            return (
                <div style={{minHeight: '100vh'}}>
                    <nav style={{background: 'rgba(212, 168, 60, 0.1)', borderBottom: '2px solid #D4A83C', padding: '1.5rem'}}>
                        <div className="container" style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                            <h1 style={{fontSize: '1.5rem', fontWeight: '700', color: '#D4A83C'}}>üîë EcoFin - Painel Profissional</h1>
                            <p style={{color: '#9ca3af', fontSize: '0.875rem'}}>Motor Definitivo v3.0</p>
                        </div>
                    </nav>

                    {view === 'lista' && (
                        <div className="container" style={{paddingTop: '2rem'}}>
                            <div style={{marginBottom: '2rem'}}>
                                <h2 style={{fontSize: '2rem', fontWeight: '700', color: '#D4A83C', marginBottom: '0.5rem'}}>Clientes</h2>
                                <p style={{color: '#9ca3af'}}>Clique para analisar ‚Ä¢ Exclua os que n√£o precisar</p>
                            </div>
                            <ListaClientes onSelectCliente={(c) => { setClienteSelecionado(c); setView('analise'); }} />
                        </div>
                    )}
                    
                    {view === 'analise' && clienteSelecionado && (
                        <AnaliseCompleta cliente={clienteSelecionado} onVoltar={() => setView('lista')} />
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
