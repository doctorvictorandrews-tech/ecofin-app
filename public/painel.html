<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoFin - An√°lise Profissional</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; }
        .section { margin-bottom: 3rem; }
        .section-title { font-size: 2rem; font-weight: 700; margin-bottom: 1.5rem; background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: rgba(255, 255, 255, 0.05); padding: 2rem; border-radius: 1rem; margin-bottom: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1); }
        .highlight-box { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%); border: 2px solid rgba(59, 130, 246, 0.5); padding: 2rem; border-radius: 1rem; margin: 2rem 0; }
        .recomendacao { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%); border: 2px solid #10b981; padding: 2.5rem; border-radius: 1rem; margin: 2rem 0; }
        .justificativa { background: rgba(255, 255, 255, 0.03); padding: 1.5rem; border-left: 4px solid #3b82f6; border-radius: 0.5rem; margin: 1rem 0; line-height: 1.8; }
        .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; padding: 1rem 2rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4); }
        .metric { text-align: center; padding: 1.5rem; }
        .metric-value { font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; }
        .metric-label { color: #9ca3af; font-size: 0.875rem; }
        .timeline { position: relative; padding-left: 2rem; margin: 2rem 0; }
        .timeline-item { margin-bottom: 2rem; position: relative; }
        .timeline-item::before { content: ''; position: absolute; left: -2rem; top: 0.5rem; width: 1rem; height: 1rem; background: #3b82f6; border-radius: 50%; }
        .timeline-item::after { content: ''; position: absolute; left: -1.5rem; top: 1.5rem; width: 2px; height: calc(100% + 1rem); background: rgba(59, 130, 246, 0.3); }
        .timeline-item:last-child::after { display: none; }
        .comparison-table { width: 100%; border-collapse: collapse; margin: 2rem 0; }
        .comparison-table th { background: rgba(59, 130, 246, 0.2); padding: 1rem; text-align: left; font-weight: 600; }
        .comparison-table td { padding: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .alert { background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; padding: 1rem; border-radius: 0.5rem; margin: 1rem 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.6s ease-out; }
        .year-row { background: rgba(255, 255, 255, 0.02); padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 4px solid #3b82f6; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==================== MOTOR DE OTIMIZA√á√ÉO ====================
        class OtimizadorFinanciamento {
            constructor(dados) {
                this.dados = dados;
                this.taxaMensal = Math.pow(1 + dados.taxaNominal, 1/12) - 1;
            }

            calcularPMT(taxa, nper, vp) {
                if (taxa === 0) return vp / nper;
                const fator = Math.pow(1 + taxa, nper);
                return vp * (taxa * fator) / (fator - 1);
            }

            simular(fgtsInicial, amortMensal) {
                let saldo = this.dados.saldoDevedor - (fgtsInicial || 0);
                const detalhes = [];
                let totalPago = fgtsInicial || 0;
                let totalJuros = 0;
                let mes = 0;

                while (saldo > 0 && mes < 600) {
                    const juros = saldo * this.taxaMensal;
                    let amortBase;
                    
                    if (this.dados.sistema === 'SAC') {
                        amortBase = this.dados.saldoDevedor / this.dados.prazoRestante;
                    } else {
                        const pmt = this.calcularPMT(this.taxaMensal, Math.max(1, this.dados.prazoRestante - mes), saldo);
                        amortBase = pmt - juros;
                    }

                    const amortExtra = amortMensal || 0;
                    const taxas = 75; // taxa adm + seguro
                    const parcela = juros + amortBase + amortExtra + taxas;
                    
                    saldo = Math.max(0, saldo - amortBase - amortExtra);
                    saldo *= 1.0015; // TR

                    totalPago += parcela;
                    totalJuros += juros;

                    detalhes.push({
                        mes: mes + 1,
                        ano: Math.floor(mes / 12) + 1,
                        saldo,
                        juros,
                        amortizacao: amortBase + amortExtra,
                        parcela
                    });

                    mes++;
                    if (saldo <= 1) break;
                }

                return {
                    detalhes,
                    totalPago,
                    totalJuros,
                    prazoMeses: mes,
                    economia: 0
                };
            }

            encontrarPontoOtimo(objetivo, recursos) {
                if (objetivo === 'quitar_rapido') {
                    return this.otimizarQuitacaoRapida(recursos);
                } else {
                    return this.otimizarEconomia(recursos);
                }
            }

            otimizarQuitacaoRapida(recursos) {
                const cenarios = [];
                const original = this.simular(0, 0);

                // Testar diferentes combina√ß√µes
                for (let fgtsPerc = 0; fgtsPerc <= 100; fgtsPerc += 25) {
                    for (let amortPerc = 50; amortPerc <= 100; amortPerc += 25) {
                        const fgts = (recursos.valorFGTS || 0) * (fgtsPerc / 100);
                        const amort = (recursos.capacidadeExtra || 0) * (amortPerc / 100);
                        const sim = this.simular(fgts, amort);
                        sim.economia = original.totalPago - sim.totalPago;
                        sim.reducaoPrazo = original.prazoMeses - sim.prazoMeses;
                        sim.fgtsUsado = fgts;
                        sim.amortMensal = amort;
                        sim.score = sim.reducaoPrazo * 10 + (sim.economia / 1000);
                        cenarios.push(sim);
                    }
                }

                return cenarios.sort((a, b) => b.score - a.score)[0];
            }

            otimizarEconomia(recursos) {
                const cenarios = [];
                const original = this.simular(0, 0);

                for (let fgtsPerc = 0; fgtsPerc <= 100; fgtsPerc += 25) {
                    for (let amortPerc = 30; amortPerc <= 100; amortPerc += 10) {
                        const fgts = (recursos.valorFGTS || 0) * (fgtsPerc / 100);
                        const amort = (recursos.capacidadeExtra || 0) * (amortPerc / 100);
                        const sim = this.simular(fgts, amort);
                        sim.economia = original.totalPago - sim.totalPago;
                        sim.reducaoPrazo = original.prazoMeses - sim.prazoMeses;
                        sim.fgtsUsado = fgts;
                        sim.amortMensal = amort;
                        sim.roi = sim.economia / ((fgts + (amort * sim.prazoMeses)) || 1);
                        sim.score = sim.economia + (sim.roi * 10000);
                        cenarios.push(sim);
                    }
                }

                return cenarios.sort((a, b) => b.score - a.score)[0];
            }

            gerarJustificativa(estrategia, objetivo, recursos) {
                const original = this.simular(0, 0);
                const formato = (v) => new Intl.NumberFormat('pt-BR', {style: 'currency', currency: 'BRL'}).format(v);

                if (objetivo === 'quitar_rapido') {
                    return `
                        <h3 style="color: #10b981; font-size: 1.5rem; margin-bottom: 1rem;">Por que essa √© a melhor estrat√©gia para QUITAR R√ÅPIDO?</h3>
                        
                        <p style="margin-bottom: 1rem; line-height: 1.8;">
                            Analisamos matematicamente ${(recursos.capacidadeExtra > 0 ? 75 : 25)} cen√°rios diferentes e esta estrat√©gia √© a que permite 
                            <strong style="color: #10b981;">quitar seu financiamento no menor tempo poss√≠vel</strong>, considerando seus recursos dispon√≠veis.
                        </p>

                        <p style="margin-bottom: 1rem; line-height: 1.8;">
                            <strong>Comparando com n√£o fazer nada:</strong> Voc√™ quitar√° <strong style="color: #3b82f6;">${estrategia.reducaoPrazo} meses mais r√°pido</strong> 
                            (${(estrategia.reducaoPrazo/12).toFixed(1)} anos a menos). Al√©m disso, economizar√° ${formato(estrategia.economia)} em juros.
                        </p>

                        <p style="margin-bottom: 1rem; line-height: 1.8;">
                            <strong>Por que usar ${estrategia.fgtsUsado > 0 ? formato(estrategia.fgtsUsado) + ' do FGTS agora' : 'FGTS gradualmente'}?</strong> 
                            ${estrategia.fgtsUsado > (recursos.valorFGTS * 0.7) ? 
                                'Usar a maior parte do FGTS agora reduz drasticamente o saldo devedor, fazendo com que os juros futuros sejam calculados sobre um valor muito menor. Isso acelera significativamente a quita√ß√£o.' :
                                'Reservar parte do FGTS permite flexibilidade futura enquanto ainda acelera a quita√ß√£o atrav√©s das amortiza√ß√µes mensais.'}
                        </p>

                        <p style="margin-bottom: 1rem; line-height: 1.8;">
                            <strong>Sobre a amortiza√ß√£o mensal de ${formato(estrategia.amortMensal)}:</strong> 
                            Este valor foi calculado para ser o <strong>ponto √≥timo</strong> entre velocidade de quita√ß√£o e sua capacidade financeira. 
                            Valores maiores trariam ganhos marginais pequenos, enquanto valores menores estenderiam muito o prazo.
                        </p>

                        <div style="background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981; padding: 1rem; margin: 1.5rem 0; border-radius: 0.5rem;">
                            <strong style="color: #10b981;">üí° Insight importante:</strong> Cada real amortizado hoje economiza cerca de R$ ${(original.totalJuros / original.totalPago * 2).toFixed(2)} 
                            em juros ao longo do financiamento. Por isso a estrat√©gia agressiva vale a pena.
                        </div>
                    `;
                } else {
                    const roiAnual = (estrategia.roi * 12 * 100).toFixed(1);
                    return `
                        <h3 style="color: #10b981; font-size: 1.5rem; margin-bottom: 1rem;">Por que essa √© a estrat√©gia de M√ÅXIMA ECONOMIA?</h3>
                        
                        <p style="margin-bottom: 1rem; line-height: 1.8;">
                            Testamos ${(recursos.capacidadeExtra > 0 ? 88 : 25)} combina√ß√µes diferentes de FGTS e amortiza√ß√£o mensal. Esta estrat√©gia oferece o 
                            <strong style="color: #10b981;">melhor retorno sobre investimento (ROI)</strong> considerando o esfor√ßo mensal necess√°rio.
                        </p>

                        <p style="margin-bottom: 1rem; line-height: 1.8;">
                            <strong>Economia total:</strong> ${formato(estrategia.economia)} (${((estrategia.economia/original.totalPago)*100).toFixed(1)}% do custo original). 
                            Isso significa que <strong style="color: #3b82f6;">para cada R$ 1 que voc√™ investir em amortiza√ß√µes, 
                            economizar√° R$ ${estrategia.roi.toFixed(2)} em juros</strong>.
                        </p>

                        <p style="margin-bottom: 1rem; line-height: 1.8;">
                            <strong>Por que ${formato(estrategia.amortMensal)}/m√™s √© o valor ideal?</strong> 
                            Este √© o <strong>ponto de equil√≠brio perfeito</strong>. Valores maiores trazem economia adicional pequena 
                            (retorno decrescente), enquanto valores menores deixam dinheiro "na mesa". Nossa an√°lise matem√°tica identificou 
                            que este valor maximiza a rela√ß√£o custo-benef√≠cio.
                        </p>

                        <p style="margin-bottom: 1rem; line-height: 1.8;">
                            <strong>Sobre o uso do FGTS:</strong> ${estrategia.fgtsUsado > 0 ? 
                                `Usar ${formato(estrategia.fgtsUsado)} do FGTS (${((estrategia.fgtsUsado/(recursos.valorFGTS||1))*100).toFixed(0)}% do dispon√≠vel) 
                                proporciona um impulso inicial forte, reduzindo o saldo sobre o qual os juros incidem. O restante fica como reserva estrat√©gica.` :
                                'Reservar o FGTS permite maior flexibilidade futura e uma amortiza√ß√£o mensal menor ainda gera excelente economia.'}
                        </p>

                        <div style="background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981; padding: 1rem; margin: 1.5rem 0; border-radius: 0.5rem;">
                            <strong style="color: #10b981;">üí∞ ROI Efetivo:</strong> Investir nas amortiza√ß√µes rende aproximadamente ${roiAnual}% ao ano 
                            (equivalente a ${(roiAnual/12).toFixed(2)}% ao m√™s), <strong>isento de imposto de renda</strong>. 
                            Compare: poupan√ßa rende ~7% a.a., CDI ~13% a.a. (com IR). Sua amortiza√ß√£o √© muito mais rent√°vel!
                        </div>
                    `;
                }
            }

            gerarPlanoAcao(estrategia) {
                const passos = [];
                
                if (estrategia.fgtsUsado > 0) {
                    passos.push({
                        titulo: 'M√™s 1: Usar FGTS Estrategicamente',
                        descricao: `Amortizar ${new Intl.NumberFormat('pt-BR', {style: 'currency', currency: 'BRL'}).format(estrategia.fgtsUsado)} do FGTS. 
                        Solicite junto ao banco e escolha "REDUZIR PRAZO" para m√°ximo impacto.`,
                        prazo: 'M√™s 1',
                        icone: 'üí∞'
                    });
                }

                passos.push({
                    titulo: `Meses ${estrategia.fgtsUsado > 0 ? '2-12' : '1-12'}: Estabelecer Rotina de Amortiza√ß√£o`,
                    descricao: `Amorizar ${new Intl.NumberFormat('pt-BR', {style: 'currency', currency: 'BRL'}).format(estrategia.amortMensal)} todo m√™s. 
                    Configure d√©bito autom√°tico ou crie um alerta no calend√°rio.`,
                    prazo: 'Primeiro ano',
                    icone: 'üìÖ'
                });

                const meta25 = Math.ceil(estrategia.prazoMeses * 0.25);
                const meta50 = Math.ceil(estrategia.prazoMeses * 0.5);
                const meta75 = Math.ceil(estrategia.prazoMeses * 0.75);

                passos.push({
                    titulo: `M√™s ${meta25}: Marco 25% - Primeira Revis√£o`,
                    descricao: 'Voc√™ ter√° quitado 1/4 do financiamento. Revise sua capacidade financeira e considere aumentar amortiza√ß√£o se poss√≠vel.',
                    prazo: `M√™s ${meta25}`,
                    icone: 'üéØ'
                });

                passos.push({
                    titulo: `M√™s ${meta50}: Marco 50% - Ponto de Virada`,
                    descricao: 'Metade do caminho! A partir daqui, os juros caem significativamente. Mantenha o ritmo.',
                    prazo: `M√™s ${meta50}`,
                    icone: '‚ö°'
                });

                passos.push({
                    titulo: `M√™s ${meta75}: Marco 75% - Reta Final`,
                    descricao: 'Faltam apenas 25%! Os juros j√° s√£o muito menores. Considere acelerar ainda mais se tiver condi√ß√µes.',
                    prazo: `M√™s ${meta75}`,
                    icone: 'üèÉ'
                });

                passos.push({
                    titulo: `M√™s ${estrategia.prazoMeses}: QUITA√á√ÉO TOTAL! üéâ`,
                    descricao: 'Parab√©ns! Seu im√≥vel est√° 100% quitado. Voc√™ economizou anos de juros e agora tem patrim√¥nio livre.',
                    prazo: `M√™s ${estrategia.prazoMeses}`,
                    icone: 'üè†'
                });

                return passos;
            }

            gerarCronogramaAnual(estrategia) {
                const anos = [];
                let anoAtual = {
                    ano: 1,
                    saldoInicial: this.dados.saldoDevedor,
                    totalPago: 0,
                    totalJuros: 0,
                    totalAmortizado: 0,
                    saldoFinal: 0,
                    meses: []
                };

                estrategia.detalhes.forEach((mes, idx) => {
                    if (mes.ano > anoAtual.ano) {
                        anos.push({...anoAtual});
                        anoAtual = {
                            ano: mes.ano,
                            saldoInicial: estrategia.detalhes[idx-1].saldo,
                            totalPago: 0,
                            totalJuros: 0,
                            totalAmortizado: 0,
                            saldoFinal: 0,
                            meses: []
                        };
                    }

                    anoAtual.totalPago += mes.parcela;
                    anoAtual.totalJuros += mes.juros;
                    anoAtual.totalAmortizado += mes.amortizacao;
                    anoAtual.saldoFinal = mes.saldo;
                    anoAtual.meses.push(mes);
                });

                if (anoAtual.meses.length > 0) {
                    anos.push(anoAtual);
                }

                return anos;
            }
        }

        // ==================== COMPONENTES ====================
        
        function ListaClientes({ onSelectCliente }) {
            const [clientes, setClientes] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const fetchClientes = async () => {
                    try {
                        const response = await fetch('https://ecofin-app-production.up.railway.app/api/clientes');
                        const data = await response.json();
                        if (data.sucesso) setClientes(data.clientes);
                    } catch (err) {
                        const local = JSON.parse(localStorage.getItem('ecofin_clientes') || '[]');
                        setClientes(local);
                    } finally {
                        setLoading(false);
                    }
                };
                fetchClientes();
            }, []);

            if (loading) {
                return <div style={{textAlign: 'center', padding: '3rem'}}>
                    <div style={{width: '50px', height: '50px', border: '4px solid #3b82f6', borderTop: '4px solid transparent', borderRadius: '50%', animation: 'spin 1s linear infinite', margin: '0 auto'}}></div>
                </div>;
            }

            if (clientes.length === 0) {
                return <div style={{textAlign: 'center', padding: '3rem'}}>
                    <div style={{fontSize: '4rem', marginBottom: '1rem'}}>üì≠</div>
                    <h2>Nenhum cliente cadastrado</h2>
                </div>;
            }

            return (
                <div style={{display: 'grid', gap: '1rem'}}>
                    {clientes.map(cliente => (
                        <div key={cliente.id} className="glass" onClick={() => onSelectCliente(cliente)}
                            style={{padding: '1.5rem', cursor: 'pointer', transition: 'all 0.3s'}}
                            onMouseEnter={(e) => e.currentTarget.style.background = 'rgba(255, 255, 255, 0.08)'}
                            onMouseLeave={(e) => e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)'}>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '1rem'}}>
                                <div>
                                    <h3 style={{fontSize: '1.25rem', fontWeight: '700'}}>{cliente.nome}</h3>
                                    <p style={{color: '#9ca3af', fontSize: '0.875rem'}}>{cliente.whatsapp}</p>
                                </div>
                                <span style={{background: '#3b82f6', padding: '0.25rem 0.75rem', borderRadius: '999px', fontSize: '0.75rem'}}>
                                    {cliente.objetivo?.replace('_', ' ').toUpperCase()}
                                </span>
                            </div>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '1rem', fontSize: '0.875rem'}}>
                                <div><p style={{color: '#9ca3af'}}>Banco</p><p style={{fontWeight: '600'}}>{cliente.banco}</p></div>
                                <div><p style={{color: '#9ca3af'}}>Saldo</p><p style={{fontWeight: '600'}}>R$ {cliente.saldoDevedor?.toLocaleString('pt-BR')}</p></div>
                                <div><p style={{color: '#9ca3af'}}>Taxa</p><p style={{fontWeight: '600'}}>{((cliente.taxaNominal||cliente.taxaAnual)*100).toFixed(2)}%</p></div>
                                <div><p style={{color: '#9ca3af'}}>Prazo</p><p style={{fontWeight: '600'}}>{cliente.prazoRestante}m</p></div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        function AnaliseProfissional({ cliente, onVoltar, modoVisualizacao }) {
            const formato = (v) => new Intl.NumberFormat('pt-BR', {style: 'currency', currency: 'BRL'}).format(v);
            const chartRef = useRef(null);

            const otimizador = new OtimizadorFinanciamento({
                sistema: cliente.sistema,
                saldoDevedor: cliente.saldoDevedor,
                taxaNominal: cliente.taxaNominal || cliente.taxaAnual,
                prazoRestante: cliente.prazoRestante
            });

            const recursos = {
                valorFGTS: cliente.valorFGTS || 0,
                capacidadeExtra: cliente.capacidadeExtra || 0
            };

            const estrategiaOtima = otimizador.encontrarPontoOtimo(cliente.objetivo || 'economia', recursos);
            const original = otimizador.simular(0, 0);
            const justificativa = otimizador.gerarJustificativa(estrategiaOtima, cliente.objetivo || 'economia', recursos);
            const planoAcao = otimizador.gerarPlanoAcao(estrategiaOtima);
            const cronogramaAnual = otimizador.gerarCronogramaAnual(estrategiaOtima);

            const compartilharLink = () => {
                const url = `${window.location.origin}/relatorio/${cliente.id}`;
                navigator.clipboard.writeText(url);
                alert('Link copiado! Compartilhe com seu cliente: ' + url);
            };

            useEffect(() => {
                if (chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    if (window.myChart) window.myChart.destroy();

                    const datasets = [
                        {
                            label: 'Sem Fazer Nada',
                            data: original.detalhes.filter((_, i) => i % 6 === 0).map(d => d.saldo),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2
                        },
                        {
                            label: 'Estrat√©gia Otimizada',
                            data: estrategiaOtima.detalhes.filter((_, i) => i % 6 === 0).map(d => d.saldo),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3
                        }
                    ];

                    window.myChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({length: Math.ceil(Math.max(original.prazoMeses, estrategiaOtima.prazoMeses)/6)}, (_, i) => `${i*6}m`),
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { labels: { color: '#fff' } } },
                            scales: {
                                y: { ticks: { color: '#9ca3af', callback: (v) => 'R$ ' + (v/1000).toFixed(0) + 'k' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                                x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                            }
                        }
                    });
                }
            }, []);

            return (
                <div className="container">
                    {!modoVisualizacao && (
                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '2rem'}}>
                            <button onClick={onVoltar} className="btn-primary">‚Üê Voltar</button>
                            <button onClick={compartilharLink} className="btn-primary">üîó Compartilhar com Cliente</button>
                        </div>
                    )}

                    {/* SE√á√ÉO 1: DIAGN√ìSTICO */}
                    <div className="section animate-in">
                        <h2 className="section-title">üìä Diagn√≥stico Completo</h2>
                        <div className="card">
                            <h3 style={{fontSize: '1.5rem', marginBottom: '1.5rem'}}>Situa√ß√£o Atual de {cliente.nome}</h3>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '2rem'}}>
                                <div className="metric">
                                    <div className="metric-value" style={{color: '#ef4444'}}>{formato(cliente.saldoDevedor)}</div>
                                    <div className="metric-label">Saldo Devedor</div>
                                </div>
                                <div className="metric">
                                    <div className="metric-value" style={{color: '#f59e0b'}}>{((cliente.taxaNominal||cliente.taxaAnual)*100).toFixed(2)}%</div>
                                    <div className="metric-label">Taxa ao Ano</div>
                                </div>
                                <div className="metric">
                                    <div className="metric-value" style={{color: '#3b82f6'}}>{(cliente.prazoRestante/12).toFixed(1)} anos</div>
                                    <div className="metric-label">Prazo Restante</div>
                                </div>
                                <div className="metric">
                                    <div className="metric-value" style={{color: '#8b5cf6'}}>{formato(original.totalPago)}</div>
                                    <div className="metric-label">Total a Pagar</div>
                                </div>
                            </div>
                        </div>

                        <div className="alert">
                            <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Se continuar sem fazer altera√ß√µes, voc√™ pagar√° {formato(original.totalJuros)} em juros 
                            ao longo de {(original.prazoMeses/12).toFixed(1)} anos. Isso representa {((original.totalJuros/cliente.saldoDevedor)*100).toFixed(0)}% 
                            do valor que voc√™ deve hoje!
                        </div>
                    </div>

                    {/* SE√á√ÉO 2: ESTRAT√âGIA RECOMENDADA */}
                    <div className="section animate-in">
                        <h2 className="section-title">üéØ Estrat√©gia Otimizada Recomendada</h2>
                        <div className="recomendacao">
                            <div style={{display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '2rem'}}>
                                <div style={{fontSize: '4rem'}}>üöÄ</div>
                                <div>
                                    <h3 style={{fontSize: '2rem', fontWeight: '700'}}>
                                        {cliente.objetivo === 'quitar_rapido' ? 'Quita√ß√£o Acelerada Inteligente' : 'M√°xima Economia Otimizada'}
                                    </h3>
                                    <p style={{color: '#6ee7b7', fontSize: '1.125rem'}}>
                                        Testamos {recursos.capacidadeExtra > 0 ? '75+' : '25'} cen√°rios - Esta √© matematicamente a melhor!
                                    </p>
                                </div>
                            </div>

                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '2rem', marginBottom: '2rem'}}>
                                <div className="metric">
                                    <div className="metric-value" style={{color: '#10b981'}}>{formato(estrategiaOtima.economia)}</div>
                                    <div className="metric-label">Economia Total</div>
                                    <div style={{color: '#6ee7b7', fontSize: '0.875rem', marginTop: '0.5rem'}}>
                                        {((estrategiaOtima.economia/original.totalPago)*100).toFixed(1)}% menos
                                    </div>
                                </div>
                                <div className="metric">
                                    <div className="metric-value" style={{color: '#3b82f6'}}>{estrategiaOtima.reducaoPrazo}</div>
                                    <div className="metric-label">Meses Economizados</div>
                                    <div style={{color: '#93c5fd', fontSize: '0.875rem', marginTop: '0.5rem'}}>
                                        {(estrategiaOtima.reducaoPrazo/12).toFixed(1)} anos a menos
                                    </div>
                                </div>
                                <div className="metric">
                                    <div className="metric-value" style={{color: '#8b5cf6'}}>{(estrategiaOtima.prazoMeses/12).toFixed(1)}</div>
                                    <div className="metric-label">Anos para Quitar</div>
                                    <div style={{color: '#c4b5fd', fontSize: '0.875rem', marginTop: '0.5rem'}}>
                                        {estrategiaOtima.prazoMeses} meses
                                    </div>
                                </div>
                            </div>

                            <div style={{background: 'rgba(0,0,0,0.2)', padding: '1.5rem', borderRadius: '0.5rem', marginTop: '2rem'}}>
                                <h4 style={{fontSize: '1.25rem', marginBottom: '1rem', color: '#10b981'}}>üìå Resumo da Estrat√©gia:</h4>
                                <ul style={{listStyle: 'none', padding: 0}}>
                                    {estrategiaOtima.fgtsUsado > 0 && (
                                        <li style={{padding: '0.75rem 0', borderBottom: '1px solid rgba(255,255,255,0.1)'}}>
                                            <strong>üí∞ FGTS:</strong> Usar {formato(estrategiaOtima.fgtsUsado)} na primeira amortiza√ß√£o
                                        </li>
                                    )}
                                    <li style={{padding: '0.75rem 0', borderBottom: '1px solid rgba(255,255,255,0.1)'}}>
                                        <strong>üìÖ Amortiza√ß√£o Mensal:</strong> {formato(estrategiaOtima.amortMensal)} todo m√™s
                                    </li>
                                    <li style={{padding: '0.75rem 0'}}>
                                        <strong>üéØ Resultado:</strong> Quita√ß√£o em {(estrategiaOtima.prazoMeses/12).toFixed(1)} anos com economia de {formato(estrategiaOtima.economia)}
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div className="justificativa" dangerouslySetInnerHTML={{ __html: justificativa }}></div>
                    </div>

                    {/* SE√á√ÉO 3: PLANO DE A√á√ÉO */}
                    <div className="section animate-in">
                        <h2 className="section-title">üìã Plano de A√ß√£o Detalhado</h2>
                        <div className="card">
                            <div className="timeline">
                                {planoAcao.map((passo, idx) => (
                                    <div key={idx} className="timeline-item">
                                        <div style={{display: 'flex', gap: '1rem'}}>
                                            <div style={{fontSize: '2rem'}}>{passo.icone}</div>
                                            <div style={{flex: 1}}>
                                                <div style={{color: '#60a5fa', fontSize: '0.875rem', fontWeight: '600', marginBottom: '0.5rem'}}>
                                                    {passo.prazo}
                                                </div>
                                                <h4 style={{fontSize: '1.25rem', fontWeight: '700', marginBottom: '0.5rem'}}>
                                                    {passo.titulo}
                                                </h4>
                                                <p style={{color: '#9ca3af', lineHeight: '1.6'}}>
                                                    {passo.descricao}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* SE√á√ÉO 4: CRONOGRAMA ANUAL */}
                    <div className="section animate-in">
                        <h2 className="section-title">üìÖ Proje√ß√£o Ano a Ano</h2>
                        <div className="card">
                            {cronogramaAnual.slice(0, 10).map((ano) => (
                                <div key={ano.ano} className="year-row">
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem'}}>
                                        <h4 style={{fontSize: '1.5rem', fontWeight: '700'}}>Ano {ano.ano}</h4>
                                        <div style={{color: '#3b82f6', fontWeight: '600'}}>
                                            Saldo: {formato(ano.saldoInicial)} ‚Üí {formato(ano.saldoFinal)}
                                        </div>
                                    </div>
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', fontSize: '0.875rem'}}>
                                        <div>
                                            <p style={{color: '#9ca3af'}}>Total Pago</p>
                                            <p style={{fontWeight: '600'}}>{formato(ano.totalPago)}</p>
                                        </div>
                                        <div>
                                            <p style={{color: '#9ca3af'}}>Juros Pagos</p>
                                            <p style={{fontWeight: '600', color: '#ef4444'}}>{formato(ano.totalJuros)}</p>
                                        </div>
                                        <div>
                                            <p style={{color: '#9ca3af'}}>Amortizado</p>
                                            <p style={{fontWeight: '600', color: '#10b981'}}>{formato(ano.totalAmortizado)}</p>
                                        </div>
                                        <div>
                                            <p style={{color: '#9ca3af'}}>% Quitado</p>
                                            <p style={{fontWeight: '600'}}>
                                                {((1 - ano.saldoFinal/cliente.saldoDevedor)*100).toFixed(1)}%
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                            {cronogramaAnual.length > 10 && (
                                <p style={{textAlign: 'center', color: '#9ca3af', marginTop: '1rem'}}>
                                    Mostrando primeiros 10 anos de {cronogramaAnual.length}
                                </p>
                            )}
                        </div>
                    </div>

                    {/* SE√á√ÉO 5: GR√ÅFICO COMPARATIVO */}
                    <div className="section animate-in">
                        <h2 className="section-title">üìà Compara√ß√£o Visual</h2>
                        <div className="card">
                            <div style={{height: '400px'}}>
                                <canvas ref={chartRef}></canvas>
                            </div>
                            <div className="highlight-box" style={{marginTop: '2rem'}}>
                                <p style={{fontSize: '1.125rem', lineHeight: '1.8', textAlign: 'center'}}>
                                    <strong>A √°rea entre as linhas</strong> representa a economia real de {formato(estrategiaOtima.economia)}. 
                                    Quanto mais cedo voc√™ come√ßar, maior ser√° o benef√≠cio!
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* COMPARA√á√ÉO FINAL */}
                    <div className="section animate-in">
                        <h2 className="section-title">‚öñÔ∏è Compara√ß√£o Final</h2>
                        <div className="card">
                            <table className="comparison-table">
                                <thead>
                                    <tr>
                                        <th>M√©trica</th>
                                        <th>Sem Fazer Nada</th>
                                        <th>Com Estrat√©gia Otimizada</th>
                                        <th>Diferen√ßa</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Prazo Total</strong></td>
                                        <td>{(original.prazoMeses/12).toFixed(1)} anos</td>
                                        <td style={{color: '#10b981'}}>{(estrategiaOtima.prazoMeses/12).toFixed(1)} anos</td>
                                        <td style={{color: '#10b981', fontWeight: '600'}}>
                                            {(estrategiaOtima.reducaoPrazo/12).toFixed(1)} anos menos
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total Pago</strong></td>
                                        <td>{formato(original.totalPago)}</td>
                                        <td style={{color: '#10b981'}}>{formato(estrategiaOtima.totalPago)}</td>
                                        <td style={{color: '#10b981', fontWeight: '600'}}>
                                            -{formato(estrategiaOtima.economia)}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total em Juros</strong></td>
                                        <td style={{color: '#ef4444'}}>{formato(original.totalJuros)}</td>
                                        <td style={{color: '#10b981'}}>{formato(estrategiaOtima.totalJuros)}</td>
                                        <td style={{color: '#10b981', fontWeight: '600'}}>
                                            -{formato(original.totalJuros - estrategiaOtima.totalJuros)}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Custo Mensal M√©dio</strong></td>
                                        <td>{formato(original.totalPago / original.prazoMeses)}</td>
                                        <td>{formato(estrategiaOtima.totalPago / estrategiaOtima.prazoMeses)}</td>
                                        <td style={{color: '#3b82f6', fontWeight: '600'}}>
                                            {formato((estrategiaOtima.totalPago / estrategiaOtima.prazoMeses) - (original.totalPago / original.prazoMeses))}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        // APP PRINCIPAL
        function App() {
            const [view, setView] = useState('lista');
            const [clienteSelecionado, setClienteSelecionado] = useState(null);

            return (
                <div style={{minHeight: '100vh'}}>
                    <nav style={{background: 'rgba(0,0,0,0.3)', backdropFilter: 'blur(10px)', borderBottom: '1px solid rgba(255,255,255,0.1)', padding: '1.5rem'}}>
                        <div className="container" style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                            <h1 style={{fontSize: '1.5rem', fontWeight: '700'}}>
                                <span style={{background: 'linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent'}}>
                                    EcoFin
                                </span> An√°lise Profissional
                            </h1>
                        </div>
                    </nav>

                    <div style={{padding: '2rem 0'}}>
                        {view === 'lista' && (
                            <div className="container">
                                <div style={{marginBottom: '2rem'}}>
                                    <h2 style={{fontSize: '2rem', fontWeight: '700', marginBottom: '0.5rem'}}>Clientes Cadastrados</h2>
                                    <p style={{color: '#9ca3af'}}>Clique para gerar an√°lise profissional completa</p>
                                </div>
                                <ListaClientes onSelectCliente={(c) => { setClienteSelecionado(c); setView('analise'); }} />
                            </div>
                        )}
                        
                        {view === 'analise' && clienteSelecionado && (
                            <AnaliseProfissional 
                                cliente={clienteSelecionado}
                                onVoltar={() => setView('lista')}
                                modoVisualizacao={false}
                            />
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
